import{_ as J}from"./Df0YsK8_.js";import{_ as L,c,o,a as s,i as w,t as y,b as C,r as h,x as T,f as D,F as E,y as O,d as A,n as q,D as K,k as R,E as Y,s as Z,l as N,u as B,G as ee,w as te}from"./BWpRghuz.js";import{b as ne,_ as se,a as ae}from"./Be6zGHtV.js";import{_ as oe}from"./BD5h4DEZ.js";import{u as ce}from"./D0YskpLl.js";import"./x00h1FS_.js";import"./DKYKsfuH.js";const ie={class:"container"},le={class:"flex"},re={class:"text-content"},ue=["src","alt"],de={key:1},me={class:"btn"},pe=["src","alt"],_e={__name:"Banner",props:{title:{type:String},image:{type:String,default:""},description:{type:String}},setup(i){return(b,p)=>{const k=J;return o(),c("div",ie,[s("div",le,[s("div",re,[s("h2",null,y(i.title),1),i.image?(o(),c("img",{key:0,src:i.image,alt:i.title,class:"none"},null,8,ue)):w("",!0),i.description?(o(),c("p",de,y(i.description),1)):w("",!0),s("div",me,[C(k)])]),i.image?(o(),c("img",{key:0,src:i.image,alt:i.title,class:"img"},null,8,pe)):w("",!0)])])}}},ve=L(_e,[["__scopeId","data-v-d84ef58b"]]),ge={class:"product-filter"},he=["onClick"],ye={key:0,class:"filter-content"},ke={key:0,class:"range-filter"},be={class:"range-values"},xe={class:"slider-container"},fe=["min","max","step","value","onInput"],Pe=["min","max","step","value","onInput"],$e={class:"slider-track"},we={key:1,class:"checkbox-filter"},Ce={class:"checkbox-option"},Fe=["value","checked","onChange"],Ie={class:"filter-actions"},Me={key:0},Be={__name:"ProductFilter",props:{filters:{type:Array,default:()=>[]},totalProducts:{type:Number,default:0}},emits:["filter-change","filter-preview"],setup(i,{emit:b}){const p=i,k=b,g=h({}),n=T({}),v=T({}),u=h(0),d=h(!1);let l=null;p.filters.forEach(e=>{g.value[e.name]=!0}),D(()=>({...n}),async e=>{l&&clearTimeout(l),l=setTimeout(async()=>{await x(e)},300)},{deep:!0});const x=async e=>{if(Object.keys(e).length===0){u.value=0,k("filter-preview",{filters:{},count:0});return}d.value=!0;try{const a=await $fetch("/api/products/filter-count",{method:"POST",body:{filters:e}});u.value=a.count,k("filter-preview",{filters:{...e},count:a.count})}catch(a){console.error("Error loading preview count:",a),u.value=0}finally{d.value=!1}},f=(e,a)=>Array.isArray(n[e])&&n[e].includes(a),j=(e,a)=>{Array.isArray(n[e])||(n[e]=[]);const t=n[e];t.indexOf(a)!==-1?(n[e]=t.filter(P=>P!==a),n[e].length===0&&delete n[e]):n[e]=[...t,a]},S=(e,a,t)=>{const r=parseFloat(t);n[e]||(n[e]=[p.filters.find(P=>P.name===e)?.min??0,p.filters.find(P=>P.name===e)?.max??0]),n[e][a]=r,a===0&&n[e][1]<r?n[e][1]=r:a===1&&n[e][0]>r&&(n[e][0]=r)},_=(e,a)=>(e-a.min)/(a.max-a.min)*100,F=()=>{Object.keys(v).forEach(e=>{delete v[e]}),Object.keys(n).forEach(e=>{v[e]=Array.isArray(n[e])?[...n[e]]:n[e]}),k("filter-change",{...v})},I=()=>{Object.keys(n).forEach(e=>{delete n[e]}),Object.keys(v).forEach(e=>{delete v[e]}),u.value=0,k("filter-change",{}),k("filter-preview",{filters:{},count:0})},V=e=>{g.value[e]=!g.value[e]};return(e,a)=>(o(),c("div",ge,[(o(!0),c(E,null,O(i.filters,t=>(o(),c("div",{class:"filter-section",key:t.name},[s("div",{class:"filter-header",onClick:r=>V(t.name)},[A(y(t.name)+" ",1),s("span",{class:q(["dropdown-arrow",{rotated:!g.value[t.name]}])},null,2)],8,he),g.value[t.name]?(o(),c("div",ye,[t.type==="range"?(o(),c("div",ke,[s("div",be,[s("span",null,"От: "+y(n[t.name]?.[0]??t.min),1),s("span",null,"До: "+y(n[t.name]?.[1]??t.max),1)]),s("div",xe,[s("input",{type:"range",min:t.min,max:t.max,step:t.step||1,value:n[t.name]?.[0]??t.min,onInput:r=>S(t.name,0,r.target.value),class:"slider"},null,40,fe),s("input",{type:"range",min:t.min,max:t.max,step:t.step||1,value:n[t.name]?.[1]??t.max,onInput:r=>S(t.name,1,r.target.value),class:"slider"},null,40,Pe),s("div",$e,[s("div",{class:"slider-range",style:K({left:_(n[t.name]?.[0]??t.min,t)+"%",width:_(n[t.name]?.[1]??t.max,t)-_(n[t.name]?.[0]??t.min,t)+"%"})},null,4)])])])):(o(),c("div",we,[(o(!0),c(E,null,O(t.values,r=>(o(),c("div",{key:r.value,class:"checkbox-item"},[s("label",Ce,[s("input",{type:"checkbox",class:"checkbox-input",value:r.value,checked:f(t.name,r.value),onChange:P=>j(t.name,r.value)},null,40,Fe),a[0]||(a[0]=s("span",{class:"checkmark"},null,-1)),A(" "+y(r.value)+" ("+y(r.count)+") ",1)])]))),128))]))])):w("",!0)]))),128)),s("div",Ie,[s("button",{onClick:F,class:"apply-btn"},[a[1]||(a[1]=A(" Применить ",-1)),u.value>0?(o(),c("span",Me,"("+y(u.value)+")",1)):w("",!0)]),s("button",{onClick:I,class:"reset-btn"},"Сбросить")])]))}},Se=L(Be,[["__scopeId","data-v-abc4524f"]]),Ve={key:0,class:"pagination"},Ae=["disabled"],Ee=["onClick"],Oe=["disabled"],Le={__name:"Pagination",props:{currentPage:{type:Number,required:!0,default:1},totalItems:{type:Number,required:!0,default:0},itemsPerPage:{type:Number,default:12},maxVisiblePages:{type:Number,default:5}},emits:["page-change"],setup(i,{emit:b}){const p=i,k=b,g=R(()=>Math.ceil(p.totalItems/p.itemsPerPage)),n=R(()=>{const u=[],d=Math.floor(p.maxVisiblePages/2);let l=Math.max(1,p.currentPage-d),x=Math.min(g.value,l+p.maxVisiblePages-1);x-l+1<p.maxVisiblePages&&(l=Math.max(1,x-p.maxVisiblePages+1));for(let f=l;f<=x;f++)u.push(f);return u}),v=u=>{u>=1&&u<=g.value&&u!==p.currentPage&&k("page-change",u)};return(u,d)=>g.value>0?(o(),c("div",Ve,[s("button",{class:"pagination-btn pagination-prev",disabled:i.currentPage===1,onClick:d[0]||(d[0]=l=>v(i.currentPage-1))},d[2]||(d[2]=[s("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[s("path",{d:"M10 12L6 8L10 4",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,Ae),(o(!0),c(E,null,O(n.value,l=>(o(),c("button",{key:l,class:q(["pagination-btn",{active:l===i.currentPage}]),onClick:x=>v(l)},y(l),11,Ee))),128)),s("button",{class:"pagination-btn pagination-next",disabled:i.currentPage===g.value,onClick:d[1]||(d[1]=l=>v(i.currentPage+1))},d[3]||(d[3]=[s("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[s("path",{d:"M6 4L10 8L6 12",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,Oe)])):w("",!0)}},je=L(Le,[["__scopeId","data-v-2ae64110"]]),Te=""+new URL("product1.Da3n4GrN.png",import.meta.url).href,Re={class:"products"},De={class:"container flex"},qe={class:"aside"},Ue={key:0,class:"loading"},ze={key:1,class:"products_list"},Ge={class:"card-img"},Qe={class:"price"},We={key:0,class:"no-products"},Xe={class:"container"},He={__name:"index",async setup(i){let b,p;const k=Y(),{slug:g}=k.params,n=h([]),v=h([]),u=h({}),d=h(!1),l=h(1),x=h(12),f=h(0),j=h(),S=h(null),{data:_}=([b,p]=Z(()=>ce(`/api/categories/by-slug/${g}`,"$Ul1_Xg-5SW")),b=await b,p(),b),F=async()=>{try{if(!_.value?.id)return;const m=await $fetch("/api/products/filters-available",{query:{categoryId:_.value.id}});v.value=m.filters}catch(m){console.error("Error loading filters:",m)}},I=async(m={})=>{if(_.value?.id){d.value=!0;try{const $=await $fetch("/api/products/filter",{method:"POST",body:{filters:{...m,categoryId:_.value.id},page:l.value,limit:x.value}});n.value=$.products,f.value=$.pagination.total,await F()}catch($){console.error("Error loading products:",$)}finally{d.value=!1}}},V=async()=>{await I({})},e=m=>{console.log("Preview data:",m)},a=async m=>{u.value=m,l.value=1,await I(m)},t=async m=>{l.value=m,await I(u.value)},r=()=>{console.log("Modal closed")},P=m=>{console.log("Order success, lead ID:",m)};return D(_,m=>{m&&(F(),V())}),N(()=>{_.value&&(F(),V())}),(m,$)=>{const U=ve,z=Se,G=se,Q=oe,W=ae,X=je,H=ne;return o(),c("div",null,[C(U,{title:B(_)?.name,image:B(_)?.imageUrl,description:B(_)?.description},null,8,["title","image","description"]),s("div",Re,[s("div",De,[s("div",qe,[s("h2",null,y(B(_)?.name),1),v.value.length>0?(o(),ee(z,{key:0,filters:v.value,"total-products":f.value,onFilterChange:a,onFilterPreview:e},null,8,["filters","total-products"])):w("",!0)]),d.value?(o(),c("div",Ue,"Загрузка...")):(o(),c("div",ze,[(o(!0),c(E,null,O(n.value,M=>(o(),c("div",{key:M.id,class:"card-wrapper"},[s("div",Ge,[C(G),$[0]||($[0]=s("img",{src:Te,alt:"",class:"product"},null,-1))]),C(Q,{to:`/catalog/${B(_).slug}/${M.slug}`,class:"card_title"},{default:te(()=>[A(y(M.name),1)]),_:2},1032,["to"]),s("div",Qe,y(M.price)+" руб.",1),C(W,{product:M,onSuccess:P},null,8,["product"]),$[1]||($[1]=s("div",{class:"in_stock"},"В наличии",-1))]))),128)),n.value.length===0?(o(),c("div",We," Товары не найдены ")):w("",!0)]))]),s("div",Xe,[C(X,{"current-page":l.value,"total-items":f.value,"items-per-page":x.value,onPageChange:t,class:"pagination-wrapper"},null,8,["current-page","total-items","items-per-page"])])]),C(H,{ref_key:"buyModalRef",ref:j,product:S.value,onClose:r,onSuccess:P},null,8,["product"])])}}},nt=L(He,[["__scopeId","data-v-699aa6be"]]);export{nt as default};
