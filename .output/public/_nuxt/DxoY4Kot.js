import{_ as O,r,x as M,l as F,c as n,a as e,i as k,F as C,y as D,u as o,t as g,g as L,h as m,v,A as P,o as i}from"./BWpRghuz.js";const R={class:"categories-page"},q={class:"page-header"},B={class:"categories-list"},j={class:"category-info"},A={class:"category-name"},N={class:"slug"},z={key:0,class:"category-image"},G=["src","alt"],H={class:"category-actions"},J=["onClick"],K=["onClick"],Q={key:0,class:"modal-overlay"},W={class:"modal"},X={class:"modal-header"},Y={class:"form-group"},Z={class:"form-group"},ee={class:"form-group"},te={key:0,class:"image-preview"},se=["src"],le={key:1,class:"image-preview"},oe=["src"],ae={class:"form-group"},ne={class:"form-group"},ie={class:"form-group"},re={class:"form-group"},de=["value"],ue={class:"form-actions"},ce=["disabled"],me={__name:"categories",setup(pe){const f=r(!1),d=r(!1),_=r(!1),b=r([]),u=r(null),y=r(null),c=r(null),l=M({id:null,name:"",slug:"",imageUrl:"",seoTitle:"",seoDescription:"",description:"",parentId:null}),U=async()=>{try{const a=await $fetch("/api/categories");b.value=a.categories||[]}catch(a){console.error("Ошибка загрузки категорий:",a)}},I=a=>{const t=a.target.files[0];if(t){c.value=t;const s=new FileReader;s.onload=p=>{u.value=p.target.result},s.readAsDataURL(t)}},T=()=>{u.value=null,c.value=null,y.value&&(y.value.value="")},x=()=>{l.imageUrl=""},$=()=>{l.name&&!l.slug&&(l.slug=l.name.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").trim("-"))},E=a=>{Object.assign(l,a),d.value=!0,f.value=!0,u.value=null,c.value=null},S=async a=>{if(confirm("Вы уверены, что хотите удалить эту категорию?"))try{await $fetch(`/api/categories/${a}`,{method:"DELETE"}),await U()}catch(t){console.error("Ошибка удаления категории:",t)}},V=async()=>{_.value=!0;try{let a=l.imageUrl;if(c.value){const w=new FormData;w.append("image",c.value),a=(await $fetch("/api/upload",{method:"POST",body:w})).imageUrl}const t={name:l.name,slug:l.slug,imageUrl:a,seoTitle:l.seoTitle,seoDescription:l.seoDescription,description:l.description,parentId:l.parentId},s=d.value?`/api/categories/${l.id}`:"/api/categories",p=d.value?"PUT":"POST",ge=await $fetch(s,{method:p,body:t});h(),await U()}catch(a){console.error("Ошибка сохранения категории:",a),alert(a.data?.message||"Ошибка при сохранении категории")}finally{_.value=!1}},h=()=>{f.value=!1,d.value=!1,u.value=null,c.value=null,Object.assign(l,{id:null,name:"",slug:"",imageUrl:"",seoTitle:"",seoDescription:"",description:"",parentId:null})};return F(U),(a,t)=>(i(),n("div",R,[e("div",q,[t[7]||(t[7]=e("h1",null,"Категории товаров",-1)),e("button",{onClick:t[0]||(t[0]=s=>f.value=!0),class:"add-btn"},"+ Добавить")]),e("div",B,[(i(!0),n(C,null,D(o(b),s=>(i(),n("div",{key:s.id,class:"category-item"},[e("div",j,[e("span",A,g(s.name),1),e("span",N,"("+g(s.slug)+")",1),s.imageUrl?(i(),n("div",z,[e("img",{src:s.imageUrl,alt:s.name},null,8,G)])):k("",!0)]),e("div",H,[e("button",{onClick:p=>E(s),class:"edit-btn"},"Редактировать",8,J),e("button",{onClick:p=>S(s.id),class:"delete-btn"},"Удалить",8,K)])]))),128))]),o(f)?(i(),n("div",Q,[e("div",W,[e("div",X,[e("h3",null,g(o(d)?"Редактировать":"Новая")+" категория",1),e("button",{onClick:h},"×")]),e("form",{onSubmit:L(V,["prevent"]),class:"modal-form",enctype:"multipart/form-data"},[e("div",Y,[t[8]||(t[8]=e("label",null,"Название *",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>o(l).name=s),required:"",onInput:$},null,544),[[v,o(l).name]])]),e("div",Z,[t[9]||(t[9]=e("label",null,"ЧПУ для категории *",-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o(l).slug=s),placeholder:"electronics",required:""},null,512),[[v,o(l).slug]])]),e("div",ee,[t[10]||(t[10]=e("label",null,"Изображение категории",-1)),e("input",{type:"file",accept:"image/*",onChange:I,ref_key:"fileInput",ref:y},null,544),o(u)?(i(),n("div",te,[e("img",{src:o(u),alt:"Preview"},null,8,se),e("button",{type:"button",onClick:T,class:"remove-image-btn"},"×")])):o(l).imageUrl?(i(),n("div",le,[e("img",{src:o(l).imageUrl,alt:"Current image"},null,8,oe),e("button",{type:"button",onClick:x,class:"remove-image-btn"},"×")])):k("",!0)]),e("div",ae,[t[11]||(t[11]=e("label",null,"SEO Title",-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o(l).seoTitle=s),maxlength:"255"},null,512),[[v,o(l).seoTitle]])]),e("div",ne,[t[12]||(t[12]=e("label",null,"SEO Description",-1)),m(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=s=>o(l).seoDescription=s),rows:"3",maxlength:"500"},null,512),[[v,o(l).seoDescription]])]),e("div",ie,[t[13]||(t[13]=e("label",null,"Описание категории",-1)),m(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>o(l).description=s),rows:"4"},null,512),[[v,o(l).description]])]),e("div",re,[t[15]||(t[15]=e("label",null,"Родительская категория",-1)),m(e("select",{"onUpdate:modelValue":t[6]||(t[6]=s=>o(l).parentId=s)},[t[14]||(t[14]=e("option",{value:null},"Без родителя",-1)),(i(!0),n(C,null,D(o(b).filter(s=>s.id!==o(l).id),s=>(i(),n("option",{key:s.id,value:s.id},g(s.name),9,de))),128))],512),[[P,o(l).parentId]])]),e("div",ue,[e("button",{type:"submit",disabled:o(_)},g(o(_)?"Загрузка...":o(d)?"Обновить":"Сохранить"),9,ce),e("button",{type:"button",onClick:h},"Отмена")])],32)])])):k("",!0)]))}},_e=O(me,[["__scopeId","data-v-1c4703e9"]]);export{_e as default};
