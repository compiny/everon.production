import{_ as T,s as f,r as _,k as g,c as a,a as t,i as B,h as F,A as j,u as i,z as A,F as k,y,t as n,o as r,g as M,B as V}from"./BWpRghuz.js";import{u as b}from"./D0YskpLl.js";const q={class:"applications-page"},R={class:"page-header"},z={class:"header-controls"},K={class:"filter-controls"},O=["value"],P={class:"stat-item"},Q={class:"applications-table"},U={key:0,class:"empty-state"},Z={key:1,class:"table-container"},G={class:"leads-table"},H=["onClick"],J={class:"message-cell"},W={class:"product-names"},X=["onClick"],Y={key:0,class:"modal-overlay"},tt={__name:"index",async setup(et){let o,d;const{data:m,refresh:D}=([o,d]=f(()=>b("/api/leads","$DxKOFNjEn8")),o=await o,d(),o),{data:C}=([o,d]=f(()=>b("/api/sources","$iqwdqQaRmC")),o=await o,d(),o),c=_(!1),p=_(null),u=_(""),v=g(()=>C.value?.sources||[]),h=g(()=>m.value?.leads?u.value?m.value.leads.filter(s=>s.sourceId?.toString()===u.value.toString()):m.value.leads:[]),w=s=>{if(!v.value.length||!s)return"-";const e=v.value.find(l=>l.id===s);return e?e.name:"-"},N=s=>{p.value=s,c.value=!0},$=async()=>{try{await $fetch(`/api/leads/${p.value}`,{method:"DELETE"}),D(),c.value=!1,p.value=null}catch(s){console.error("Error deleting lead:",s),alert("Ошибка при удалении заявки")}},x=()=>{c.value=!1,p.value=null},E=s=>s.replace("T"," ").replace(".000Z",""),I=s=>{V(`/admin/${s}`)},L=s=>s.productNames&&s.productNames.length>0?s.productNames.filter(e=>e).join(", "):s.productIds&&s.productIds.length>0?s.productIds.map(e=>`#${e}`).join(", "):"-";return(s,e)=>(r(),a("div",q,[t("div",R,[e[3]||(e[3]=t("h1",null,"Управление заявками",-1)),t("div",z,[t("div",K,[F(t("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>A(u)?u.value=l:null),class:"source-filter"},[e[2]||(e[2]=t("option",{value:""},"Все источники",-1)),(r(!0),a(k,null,y(i(v),l=>(r(),a("option",{key:l.id,value:l.id},n(l.name),9,O))),128))],512),[[j,i(u)]])]),t("div",P,"Всего: "+n(i(h).length),1)])]),t("div",Q,[i(h).length===0?(r(),a("div",U,n(i(u)?"Заявки по выбранному источнику не найдены":"Заявки не найдены"),1)):(r(),a("div",Z,[t("table",G,[e[4]||(e[4]=t("thead",null,[t("tr",null,[t("th",null,"ID"),t("th",null,"Имя"),t("th",null,"Email"),t("th",null,"Телефон"),t("th",null,"Источник"),t("th",null,"Сообщение"),t("th",null,"Дата создания"),t("th",null,"Товар"),t("th",null,"Действия")])],-1)),t("tbody",null,[(r(!0),a(k,null,y(i(h),l=>(r(),a("tr",{key:l.id,class:"table-row",onClick:S=>I(l.id),style:{cursor:"pointer"}},[t("td",null,n(l.id||"-"),1),t("td",null,n(l.name||"-"),1),t("td",null,n(l.email||"-"),1),t("td",null,n(l.phone||"-"),1),t("td",null,n(w(l.sourceId)||"-"),1),t("td",J,n(l.message||"-"),1),t("td",null,n(E(l.createdAt)),1),t("td",W,n(L(l)),1),t("td",{onClick:e[1]||(e[1]=M(()=>{},["stop"]))},[t("button",{onClick:S=>N(l.id),class:"delete-btn",title:"Удалить заявку"}," Удалить ",8,X)])],8,H))),128))])])]))]),i(c)?(r(),a("div",Y,[t("div",{class:"modal"},[e[5]||(e[5]=t("h3",null,"Подтверждение удаления",-1)),e[6]||(e[6]=t("p",null,"Вы уверены, что хотите удалить эту заявку?",-1)),t("div",{class:"modal-actions"},[t("button",{onClick:$,class:"btn-danger"},"Удалить"),t("button",{onClick:x,class:"btn-cancel"},"Отмена")])])])):B("",!0)]))}},nt=T(tt,[["__scopeId","data-v-6c2dd029"]]);export{nt as default};
