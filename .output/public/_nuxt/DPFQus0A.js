import{_ as L,r as w,x as S,l as V,c as i,a as e,i as h,F as x,y as E,u as n,t as r,g as F,h as _,v as f,o as d}from"./BWpRghuz.js";const M={class:"admin-news"},O={class:"page-header"},B={class:"news-list"},I={class:"news-info"},j={class:"news-date"},q={key:0,class:"news-description"},P={class:"created-at"},R={class:"news-actions"},A=["onClick"],z=["onClick"],G={key:0,class:"modal-overlay"},H={class:"modal"},J={class:"modal-header"},K={class:"form-group"},Q={class:"form-group"},W={class:"form-group"},X={class:"form-actions"},Y=["disabled"],Z={__name:"news",setup(tt){const m=w([]),v=w(!1),l=w(null),c=w(!1),a=S({title:"",date:"",description:""}),u=async()=>{try{const t=await $fetch("/api/news");m.value=t?.news||[]}catch(t){console.error("Ошибка загрузки новостей:",t)}},b=async()=>{try{await $fetch("/api/news",{method:"POST",body:a}),await u(),p()}catch(t){console.error("Ошибка создания новости:",t),alert("Ошибка при создании новости")}},y=async()=>{try{await $fetch(`/api/news/${l.value.id}`,{method:"PUT",body:a}),await u(),p()}catch(t){console.error("Ошибка обновления новости:",t),alert("Ошибка при обновлении новости")}},g=async t=>{if(confirm("Вы уверены, что хотите удалить эту новость?"))try{await $fetch(`/api/news/${t}`,{method:"DELETE"}),await u()}catch(s){console.error("Ошибка удаления новости:",s),alert("Ошибка при удалении новости")}},k=t=>{l.value=t,Object.assign(a,{title:t.title,date:N(t.date),description:t.description||""})},D=async()=>{c.value=!0;try{l.value?await y():await b()}finally{c.value=!1}},p=()=>{v.value=!1,l.value=null,Object.assign(a,{title:"",date:"",description:""})},$=t=>new Date(t).toLocaleDateString("ru-RU"),C=t=>new Date(t).toLocaleString("ru-RU"),N=t=>t.match(/^\d{4}-\d{2}-\d{2}$/)?t:new Date(t).toISOString().split("T")[0],T=(t,s)=>t?t.length>s?t.substring(0,s)+"...":t:"";return V(()=>{u()}),(t,s)=>(d(),i("div",M,[e("div",O,[s[4]||(s[4]=e("h1",null,"Управление новостями",-1)),e("button",{onClick:s[0]||(s[0]=o=>v.value=!0),class:"add-btn"},"+ Добавить")]),e("div",B,[(d(!0),i(x,null,E(n(m),o=>(d(),i("div",{key:o.id,class:"news-item"},[e("div",I,[e("h3",null,r(o.title),1),e("p",j,r($(o.date)),1),o.description?(d(),i("p",q,r(T(o.description,100)),1)):h("",!0),e("p",P,"Создано: "+r(C(o.createdAt)),1)]),e("div",R,[e("button",{onClick:U=>k(o),class:"edit-btn"},"Редактировать",8,A),e("button",{onClick:U=>g(o.id),class:"delete-btn"},"Удалить",8,z)])]))),128))]),n(v)||n(l)?(d(),i("div",G,[e("div",H,[e("div",J,[e("h3",null,r(n(l)?"Редактировать":"Создать")+" новость",1),e("button",{onClick:p},"×")]),e("form",{onSubmit:F(D,["prevent"]),class:"modal-form"},[e("div",K,[s[5]||(s[5]=e("label",null,"Заголовок *",-1)),_(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>n(a).title=o),required:""},null,512),[[f,n(a).title]])]),e("div",Q,[s[6]||(s[6]=e("label",null,"Дата новости *",-1)),_(e("input",{type:"date","onUpdate:modelValue":s[2]||(s[2]=o=>n(a).date=o),required:""},null,512),[[f,n(a).date]])]),e("div",W,[s[7]||(s[7]=e("label",null,"Описание",-1)),_(e("textarea",{"onUpdate:modelValue":s[3]||(s[3]=o=>n(a).description=o),rows:"6",placeholder:"Текст новости..."},null,512),[[f,n(a).description]])]),e("div",X,[e("button",{type:"submit",disabled:n(c)},r(n(c)?"Сохранение...":n(l)?"Обновить":"Создать"),9,Y),e("button",{type:"button",onClick:p},"Отмена")])],32)])])):h("",!0)]))}},st=L(Z,[["__scopeId","data-v-a1e3b546"]]);export{st as default};
