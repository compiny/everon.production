import{_ as w,c as d,o as u,a as e,F as H,y as S,r,i as g,u as t,d as Z,t as C,g as L,h as M,v as k,n as x,b as $,G as E,a0 as R}from"./BWpRghuz.js";import{_ as F}from"./DKYKsfuH.js";const O=""+new URL("heart.KHykRPrP.svg",import.meta.url).href,T="data:image/svg+xml,%3csvg%20width='23'%20height='21'%20viewBox='0%200%2023%2021'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M5.60258%209.60004C6.09113%209.60004%206.48721%2010.0029%206.48721%2010.5V20.1C6.48721%2020.597%206.09113%2021%205.60258%2021H0.884635C0.396076%2021%200%2020.597%200%2020.1V10.5C4.74948e-06%2010.0029%200.396079%209.60004%200.884635%209.60004H5.60258ZM13.859%200C14.3476%209.18087e-06%2014.7436%200.40297%2014.7436%200.90002V20.1C14.7436%2020.597%2014.3476%2021%2013.859%2021H9.14106C8.6525%2021%208.25642%2020.597%208.25642%2020.1V0.90002C8.25642%200.402964%208.6525%200%209.14106%200H13.859ZM22.1154%2014.4C22.6039%2014.4%2023%2014.8029%2023%2015.3V20.1C23%2020.597%2022.6039%2021%2022.1154%2021H17.3974C16.9089%2021%2016.5128%2020.597%2016.5128%2020.1V15.3C16.5129%2014.8029%2016.9089%2014.4%2017.3974%2014.4H22.1154ZM18.2821%2019.2H21.2308V16.2H18.2821V19.2ZM10.0256%2019.2H12.9744V1.80004H10.0256V19.2ZM1.76927%2019.2H4.71794V11.4H1.76927V19.2Z'%20fill='%23DCE0ED'/%3e%3c/svg%3e",N="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.13589%201.48359C8.52162%200.821321%209.47838%200.821321%209.86411%201.48359L12.011%205.16962C12.1523%205.41222%2012.3891%205.58425%2012.6635%205.64367L16.8326%206.54646C17.5816%206.70867%2017.8773%207.6186%2017.3666%208.1901L14.5244%2011.371C14.3374%2011.5803%2014.2469%2011.8587%2014.2752%2012.138L14.7049%2016.382C14.7821%2017.1445%2014.0081%2017.7069%2013.3067%2017.3978L9.40325%2015.6777C9.14634%2015.5645%208.85366%2015.5645%208.59675%2015.6777L4.69326%2017.3978C3.99192%2017.7069%203.21789%2017.1445%203.2951%2016.382L3.7248%2012.138C3.75308%2011.8587%203.66264%2011.5803%203.47558%2011.371L0.633386%208.1901C0.122732%207.6186%200.418384%206.70867%201.16744%206.54646L5.3365%205.64367C5.61089%205.58425%205.84767%205.41222%205.98897%205.16962L8.13589%201.48359Z'%20fill='%232044F7'/%3e%3c/svg%3e",U="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M8.13589%201.48359C8.52162%200.821321%209.47838%200.821321%209.86411%201.48359L12.011%205.16962C12.1523%205.41222%2012.3891%205.58425%2012.6635%205.64367L16.8326%206.54646C17.5816%206.70867%2017.8773%207.6186%2017.3666%208.1901L14.5244%2011.371C14.3374%2011.5803%2014.2469%2011.8587%2014.2752%2012.138L14.7049%2016.382C14.7821%2017.1445%2014.0081%2017.7069%2013.3067%2017.3978L9.40325%2015.6777C9.14634%2015.5645%208.85366%2015.5645%208.59675%2015.6777L4.69326%2017.3978C3.99192%2017.7069%203.21789%2017.1445%203.2951%2016.382L3.7248%2012.138C3.75308%2011.8587%203.66264%2011.5803%203.47558%2011.371L0.633386%208.1901C0.122732%207.6186%200.418384%206.70867%201.16744%206.54646L5.3365%205.64367C5.61089%205.58425%205.84767%205.41222%205.98897%205.16962L8.13589%201.48359Z'%20fill='%23DCE0ED'/%3e%3c/svg%3e",j={},q={class:"actions"},z={class:"stars"};function A(_,i){return u(),d("div",q,[i[1]||(i[1]=e("div",null,[e("img",{src:O,alt:"",class:"heart"}),e("img",{src:T,alt:""})],-1)),e("div",z,[(u(),d(H,null,S(4,(b,m)=>e("img",{src:N,key:m,alt:""})),64)),i[0]||(i[0]=e("img",{src:U,alt:""},null,-1))])])}const a2=Object.assign(w(j,[["render",A],["__scopeId","data-v-0a65c1c8"]]),{__name:"Actions"}),G={class:"modal-content"},K={class:"form-group"},J={key:0,class:"error-text"},Q={class:"form-group"},W={key:0,class:"error-text"},X={class:"form-group"},Y=["disabled"],e2={__name:"BuyProductModal",props:{product:{type:Object,required:!0}},emits:["close","success"],setup(_,{expose:i,emit:b}){const m=_,v=b,l=r(!1),f=r(!1),a=r(null),y=r(),o=r({name:"",phone:"",email:""}),n=r({name:"",phone:""}),V=()=>{console.log("Show modal called with product:",m.product),l.value=!0},p=()=>{l.value=!1,B(),v("close")},B=()=>{o.value={name:"",phone:"",email:""},n.value={name:"",phone:""},a.value=null},P=()=>{let c=!0;return n.value={name:"",phone:""},o.value.name.trim()||(n.value.name="Введите ваше имя",c=!1),y.value?.validate()||(n.value.phone="Введите корректный номер телефона",c=!1),c},I=async()=>{if(P()){f.value=!0,a.value=null;try{const c=o.value.phone.replace(/\D/g,""),s=await $fetch("/api/leads/with-products",{method:"POST",body:{name:o.value.name,phone:c,email:o.value.email,productIds:[m.product.id],sourceId:3}});a.value={type:"success",text:"Заявка отправлена! Мы свяжемся с вами в ближайшее время."},setTimeout(()=>{v("success",s.leadId),p()},2e3)}catch(c){console.error("Ошибка отправки заявки:",c),a.value={type:"error",text:"Произошла ошибка. Пожалуйста, попробуйте позже."}}finally{f.value=!1}}};return i({showModal:V,closeModal:p}),(c,s)=>{const D=F;return t(l)?(u(),d("div",{key:0,class:"buy-modal",onClick:L(p,["self"])},[e("div",G,[e("button",{class:"close-btn",onClick:p},"×"),s[7]||(s[7]=e("h2",null,"Оформление заявки",-1)),e("p",null,[s[3]||(s[3]=Z("Продукт: ",-1)),e("strong",null,C(_.product.name),1)]),e("form",{onSubmit:L(I,["prevent"]),class:"buy-form"},[e("div",K,[s[4]||(s[4]=e("label",{for:"name"},"Ваше имя *",-1)),M(e("input",{"onUpdate:modelValue":s[0]||(s[0]=h=>t(o).name=h),type:"text",id:"name",class:x({"input-error":t(n).name})},null,2),[[k,t(o).name]]),t(n).name?(u(),d("span",J,C(t(n).name),1)):g("",!0)]),e("div",Q,[s[5]||(s[5]=e("label",{for:"phone"},"Телефон *",-1)),$(D,{modelValue:t(o).phone,"onUpdate:modelValue":s[1]||(s[1]=h=>t(o).phone=h),label:"",ref_key:"phoneInputRef",ref:y,placeholder:"+7 (___)-___-__-__",class:x({"input-error":t(n).phone})},null,8,["modelValue","class"]),t(n).phone?(u(),d("span",W,C(t(n).phone),1)):g("",!0)]),e("div",X,[s[6]||(s[6]=e("label",{for:"email"},"Email",-1)),M(e("input",{"onUpdate:modelValue":s[2]||(s[2]=h=>t(o).email=h),type:"email",id:"email",placeholder:"example@mail.ru"},null,512),[[k,t(o).email]])]),e("button",{type:"submit",disabled:t(f),class:"submit-btn"},C("Отправить заявку"),8,Y),t(a)?(u(),d("div",{key:0,class:x(["message",t(a).type])},C(t(a).text),3)):g("",!0)],32)])])):g("",!0)}}},t2=w(e2,[["__scopeId","data-v-e41b73ce"]]),s2=["disabled"],o2={__name:"BuyBtn",props:{product:{type:Object,required:!0}},emits:["success"],setup(_,{emit:i}){const b=_,m=i,v=r(),l=r(null),f=r(!1),a=()=>{l.value=b.product,R(()=>{v.value?.showModal()})},y=()=>{l.value=null},o=n=>{l.value=null,m("success",n)};return(n,V)=>{const p=t2;return u(),d(H,null,[e("button",{onClick:a,class:"buy-btn",disabled:t(f)}," Купить ",8,s2),t(l)?(u(),E(p,{key:0,ref_key:"buyModalRef",ref:v,product:t(l),onClose:y,onSuccess:o},null,8,["product"])):g("",!0)],64)}}},r2=w(o2,[["__scopeId","data-v-8ea7543a"]]);export{a2 as _,r2 as a,t2 as b};
