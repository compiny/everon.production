import{_ as j,r as d,k as D,l as F,c as n,a as e,i as _,u as l,t as c,h as A,v as $,z as P,F as x,y as S,g as q,o as r}from"./BWpRghuz.js";const z={class:"container"},O={class:"page-header"},Q={key:0,class:"loading"},R={key:1,class:"error"},Z={class:"error-alert"},G={key:2},H={class:"stats-grid"},J={class:"stat-card"},K={class:"table-card"},W={class:"table-header"},X={class:"search-input"},Y={class:"table-container"},ee={class:"data-table"},se={class:"action-buttons"},te=["onClick"],le=["onClick"],ae={key:0,class:"empty-state"},oe={key:3,class:"modal-overlay"},ne={class:"modal"},re={key:4,class:"modal-overlay"},ie={class:"modal"},de={class:"form-group"},ce=["disabled"],ue={key:0,class:"error-message"},ve={class:"form-actions"},me=["disabled"],fe={key:0},pe={key:1},he=["disabled"],_e={__name:"forms",setup(ye){const T=[{key:"id",label:"ID"},{key:"name",label:"–ù–∞–∑–≤–∞–Ω–∏–µ"},{key:"createdAt",label:"–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è"}],f=d(""),o=d([]),y=d(!1),p=d(null),h=d(!1),b=d(!1),k=d(!1),u=d(!1),v=d(""),m=d(null),i=d({id:null,name:""}),g=D(()=>!!i.value.id),w=D(()=>o.value.length?o.value.filter(s=>s.name&&s.name.toLowerCase().includes(f.value.toLowerCase())):[]),C=async()=>{try{y.value=!0,p.value=null;const s=await $fetch("/api/sources");Array.isArray(s)?o.value=s:s&&Array.isArray(s.sources)?o.value=s.sources:s&&Array.isArray(s.data)?o.value=s.data:o.value=[]}catch(s){console.error("Error fetching lead sources:",s),p.value=s}finally{y.value=!1}};F(C);const M=s=>s.replace("T"," ").replace(".000Z",""),L=s=>{const t=o.value.find(a=>a.id===s);t&&(m.value=t,h.value=!0)},N=s=>{i.value={...s},v.value="",k.value=!0},V=async()=>{try{if(u.value=!0,v.value="",g.value){const s=await $fetch(`/api/sources/${i.value.id}`,{method:"PUT",body:{name:i.value.name},headers:{"Content-Type":"application/json"}}),t=o.value.findIndex(a=>a.id===i.value.id);t!==-1&&(o.value[t]={...o.value[t],name:i.value.name})}else{console.log("Creating source with name:",i.value.name);const s=await $fetch("/api/sources",{method:"POST",body:{name:i.value.name},headers:{"Content-Type":"application/json"}});if(console.log("Server response:",s),s.success)o.value.unshift(s.data);else throw new Error(s.error||"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞")}E()}catch(s){console.error("Error saving source:",s),v.value=s.data?.error||s.data?.message||s.message||"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞"}finally{u.value=!1}},B=async()=>{try{await $fetch(`/api/sources/${m.value.id}`,{method:"DELETE"}),o.value=o.value.filter(s=>s.id!==m.value.id),h.value=!1,m.value=null}catch(s){console.error("Error deleting source:",s),alert(s.data?.message||"–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞")}},E=()=>{b.value=!1,k.value=!1,i.value={id:null,name:""},v.value=""},I=()=>{h.value=!1,m.value=null};return(s,t)=>(r(),n("div",z,[e("div",O,[t[3]||(t[3]=e("h1",null,"–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∑–∞—è–≤–æ–∫",-1)),e("button",{onClick:t[0]||(t[0]=a=>b.value=!0),class:"add-btn"}," + –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ ")]),l(y)?(r(),n("div",Q,t[4]||(t[4]=[e("div",{class:"spinner"},null,-1),e("p",null,"–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤...",-1)]))):l(p)?(r(),n("div",R,[e("div",Z,[t[5]||(t[5]=e("h3",null,"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",-1)),e("p",null,c(l(p).message),1)]),e("button",{onClick:C,class:"retry-btn"}," –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞ ")])):(r(),n("div",G,[e("div",H,[e("div",J," –í—Å–µ–≥–æ: "+c(l(o).length),1)]),e("div",K,[e("div",W,[e("div",X,[A(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>P(f)?f.value=a:null),placeholder:"–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...",type:"text"},null,512),[[$,l(f)]]),t[6]||(t[6]=e("span",{class:"search-icon"},"üîç",-1))])]),e("div",Y,[e("table",ee,[e("thead",null,[e("tr",null,[(r(),n(x,null,S(T,a=>e("th",{key:a.key,class:"table-header-cell"},c(a.label),1)),64)),t[7]||(t[7]=e("th",{class:"table-header-cell"},"–î–µ–π—Å—Ç–≤–∏—è",-1))])]),e("tbody",null,[(r(!0),n(x,null,S(l(w),a=>(r(),n("tr",{key:a.id,class:"table-row"},[e("td",null,c(a.id),1),e("td",null,c(a.name),1),e("td",null,c(M(a.createdAt)),1),e("td",null,[e("div",se,[e("button",{onClick:U=>N(a),class:"edit-btn",title:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫"}," ‚úèÔ∏è ",8,te),e("button",{onClick:U=>L(a.id),class:"delete-btn",title:"–£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫"}," üóëÔ∏è ",8,le)])])]))),128))])]),l(w).length===0?(r(),n("div",ae,t[8]||(t[8]=[e("p",null,"–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",-1)]))):_("",!0)])])])),l(h)?(r(),n("div",oe,[e("div",ne,[t[9]||(t[9]=e("h3",null,"–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è",-1)),e("p",null,'–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ "'+c(l(m)?.name)+'"?',1),e("div",{class:"modal-actions"},[e("button",{onClick:B,class:"btn-danger"},"–£–¥–∞–ª–∏—Ç—å"),e("button",{onClick:I,class:"btn-cancel"},"–û—Ç–º–µ–Ω–∞")])])])):_("",!0),l(b)||l(k)?(r(),n("div",re,[e("div",ie,[e("h3",null,c(l(g)?"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ":"–î–æ–±–∞–≤–ª–µ–Ω–∏–µ")+" –∏—Å—Ç–æ—á–Ω–∏–∫–∞",1),e("form",{onSubmit:q(V,["prevent"]),class:"source-form"},[e("div",de,[t[10]||(t[10]=e("label",{for:"sourceName"},"–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞:",-1)),A(e("input",{id:"sourceName","onUpdate:modelValue":t[2]||(t[2]=a=>l(i).name=a),type:"text",required:"",placeholder:"–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞",disabled:l(u)},null,8,ce),[[$,l(i).name]])]),l(v)?(r(),n("div",ue,c(l(v)),1)):_("",!0),e("div",ve,[e("button",{type:"submit",class:"btn-primary",disabled:l(u)||!l(i).name.trim()},[l(u)?(r(),n("span",fe,"–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...")):(r(),n("span",pe,c(l(g)?"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å":"–î–æ–±–∞–≤–∏—Ç—å"),1))],8,me),e("button",{type:"button",onClick:E,class:"btn-cancel",disabled:l(u)}," –û—Ç–º–µ–Ω–∞ ",8,he)])],32)])])):_("",!0)]))}},ke=j(_e,[["__scopeId","data-v-cd384b86"]]);export{ke as default};
