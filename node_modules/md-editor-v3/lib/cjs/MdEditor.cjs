"use strict";const H=require("./chunks/index.cjs"),X=require("./chunks/index4.cjs"),S=require("./chunks/index3.cjs"),je=require("./ModalToolbar.cjs"),Ae=require("./NormalToolbar.cjs"),e=require("vue"),n=require("./chunks/config.cjs"),W=require("@vavt/util"),F=require("@codemirror/commands"),Re=require("@codemirror/lang-markdown"),Pe=require("@codemirror/language-data"),N=require("@codemirror/state"),$=require("@codemirror/view"),s=require("./chunks/event-bus.cjs"),z=require("@codemirror/language"),Me=require("@codemirror/autocomplete"),De=require("./chunks/dom.cjs"),C=require("./chunks/index2.cjs"),Fe=require("./chunks/index5.cjs"),b=require("@lezer/highlight"),Be=require("@codemirror/search"),ce=require("./chunks/vue-tsx.cjs"),He=(t,o,a)=>{const l=e.inject("editorId"),i=e.inject("setting");let r=()=>{},c=()=>{};const d=()=>{r();const u=a.value?.view.contentDOM.getRootNode(),f=u?.querySelector(`#${l} .cm-scroller`),m=u?.querySelector(`[id="${l}-preview-wrapper"]`),g=u?.querySelector(`[id="${l}-html-wrapper"]`);(m||g)&&([c,r]=(m?X.scrollAuto:X.scrollAutoWithScale)(f,m||g,a.value),t.scrollAuto&&c())};e.watch([o,i],()=>{e.nextTick(d)}),e.watch(()=>t.scrollAuto,u=>{u?c():r()}),e.watch(()=>i.value.previewOnly,u=>{u?r():c()}),e.onMounted(d)},Q=async(t,o,a)=>{if(/^h[1-6]$/.test(t))return Oe(t,o);if(t==="prettier")return await _e(o,a);switch(t){case"bold":case"underline":case"italic":case"strikeThrough":case"sub":case"sup":case"codeRow":case"katexInline":case"katexBlock":return We(t,o);case"quote":case"orderedList":case"unorderedList":case"task":return Ue(t,o);case"code":return Ke(a,o);case"table":return Ze(a);case"link":{const l=o.getSelectedText(),{desc:i=l,url:r=""}=a,c=`[${i}](${r})`;return{text:c,options:{select:r==="",deviationStart:c.length-r.length-1,deviationEnd:-1}}}case"image":return Ye(a,o);case"flow":case"sequence":case"gantt":case"class":case"state":case"pie":case"relationship":case"journey":return Ge(t);case"universal":return Xe(o.getSelectedText(),a);default:return{text:"",options:{}}}},Oe=(t,o)=>{const a=t.slice(1),l="#".repeat(Number(a)),[i,r,c]=ne(o,{wholeLine:!0});return{text:`${l} ${i}`,options:{deviationStart:l.length+1,replaceStart:r,replaceEnd:c}}},_e=async(t,o)=>{const a=window.prettier||n.globalConfig.editorExtensions.prettier?.prettierInstance,l=[window.prettierPlugins?.markdown||n.globalConfig.editorExtensions.prettier?.parserMarkdownInstance];return!a||!l[0]?(s.bus.emit(o.editorId,s.ERROR_CATCHER,{name:"prettier",message:"prettier is undefined"}),{text:t.getValue(),options:{select:!1,replaceAll:!0}}):{text:await a.format(t.getValue(),{parser:"markdown",plugins:l}),options:{select:!1,replaceAll:!0}}},qe={bold:["**","**",2,-2],underline:["<u>","</u>",3,-4],italic:["*","*",1,-1],strikeThrough:["~~","~~",2,-2],sub:["~","~",1,-1],sup:["^","^",1,-1],codeRow:["`","`",1,-1],katexInline:["$","$",1,-1],katexBlock:[`
$$
`,`
$$
`,4,-4]},We=(t,o)=>{const a=o.getSelectedText(),[l,i,r,c]=qe[t];return{text:`${l}${a}${i}`,options:{deviationStart:r,deviationEnd:c}}},ze={quote:"> ",unorderedList:"- ",orderedList:1,task:"- [ ] "},Ue=(t,o)=>{const[a,l,i]=ne(o,{wholeLine:!0}),r=a.split(`
`),c=ze[t],d=t==="orderedList"?r.map((m,g)=>`${c+g}. ${m}`):r.map(m=>`${c}${m}`),u=t==="orderedList"?"1. ":c.toString(),f=r.length===1?u.length:0;return{text:d.join(`
`),options:{deviationStart:f,replaceStart:l,replaceEnd:i}}},Ke=(t,o)=>{const[a,l,i]=ne(o),r=t.mode||"language",c=`
\`\`\`${r}
${t.text||a||""}
\`\`\`
`;return{text:c,options:{deviationStart:4,deviationEnd:4+r.length-c.length,replaceStart:l,replaceEnd:i}}},Ge=t=>({text:`
\`\`\`mermaid
${{flow:`flowchart TD 
  Start --> Stop`,sequence:`sequenceDiagram
  A->>B: hello!
  B-->>A: hi!`,gantt:`gantt
title Gantt Chart
dateFormat  YYYY-MM-DD`,class:`classDiagram
  class Animal`,state:`stateDiagram-v2
  s1 --> s2`,pie:`pie
  "Dogs" : 386
  "Cats" : 85
  "Rats" : 15`,relationship:`erDiagram
  CAR ||--o{ NAMED-DRIVER : allows`,journey:`journey
  title My Journey`,...n.globalConfig.editorConfig.mermaidTemplate}[t]}
\`\`\`
`,options:{deviationStart:12,deviationEnd:-5}}),Ye=(t,o)=>{const a=o.getSelectedText(),{desc:l=a,url:i="",urls:r}=t;let c="";const d=i===""&&(!r||r instanceof Array&&r.length===0);return r instanceof Array?c=r.reduce((u,f)=>{const{url:m="",alt:g="",title:p=""}=typeof f=="object"?f:{url:f};return u+`![${g}](${m}${p?" '"+p+"'":""})
`},""):c=`![${l}](${i})
`,{text:c,options:{select:i==="",deviationStart:d?c.length-i.length-2:c.length,deviationEnd:d?-2:0}}},Ze=t=>{const{selectedShape:o={x:1,y:1}}=t,{x:a,y:l}=o;let i=`
| Column`;for(let r=0;r<=l;r++)i+=" |";i+=`
|`;for(let r=0;r<=l;r++)i+=" - |";for(let r=0;r<=a;r++){i+=`
|`;for(let c=0;c<=l;c++)i+=" |"}return i+=`
`,{text:i,options:{deviationStart:3,deviationEnd:10-i.length}}},Xe=(t,o)=>{const{generate:a}=o,l=a(t);return{text:l.targetValue,options:{select:l.select??!0,deviationStart:l.deviationStart||0,deviationEnd:l.deviationEnd||0}}},ne=(t,o={wholeLine:!1})=>{const a=t.view.state,l=a.selection.main;if(l.empty){const i=a.doc.lineAt(l.from);return[a.doc.lineAt(l.from).text,i.from,i.to]}else if(o.wholeLine){const i=a.doc.lineAt(l.from),r=a.doc.lineAt(l.to);return[a.doc.sliceString(i.from,r.to),i.from,r.to]}return[a.doc.sliceString(l.from,l.to),l.from,l.to]},B=t=>{const o=new N.Compartment;return l=>(o.get(t.state)?t.dispatch({effects:o.reconfigure(l)}):t.dispatch({effects:N.StateEffect.appendConfig.of(o.of(l))}),!0)};class Je{view;maxLength=Number.MAX_SAFE_INTEGER;toggleTabSize;togglePlaceholder;setExtensions;toggleDisabled;toggleReadOnly;toggleMaxlength;getValue(){return this.view.state.doc.toString()}setValue(o,a=0,l=this.view.state.doc.length){this.view.dispatch({changes:{from:a,to:l,insert:o}})}getSelectedText(){const{from:o,to:a}=this.view.state.selection.main;return this.view.state.sliceDoc(o,a)}replaceSelectedText(o,a,l){const i={select:!0,deviationStart:0,deviationEnd:0,replaceAll:!1,replaceStart:-1,replaceEnd:-1,...a};try{if(i.replaceAll){if(this.setValue(o),o.length>this.maxLength)throw new Error("The input text is too long");return}if(this.view.state.doc.length-this.getSelectedText().length+o.length>this.maxLength)throw new Error("The input text is too long");const{from:r}=this.view.state.selection.main;i.replaceStart!==-1?this.view.dispatch({changes:{from:i.replaceStart,to:i.replaceEnd,insert:o}}):this.view.dispatch(this.view.state.replaceSelection(o)),i.select&&this.view.dispatch({selection:{anchor:i.replaceStart===-1?r+i.deviationStart:i.replaceStart+i.deviationStart,head:i.replaceStart===-1?r+o.length+i.deviationEnd:i.replaceStart+o.length+i.deviationEnd}}),this.view.focus()}catch(r){if(r.message==="The input text is too long")s.bus.emit(l,s.ERROR_CATCHER,{name:"overlength",message:r.message,data:o});else throw r}}constructor(o){this.view=o,this.toggleTabSize=B(this.view),this.togglePlaceholder=B(this.view),this.setExtensions=B(this.view),this.toggleDisabled=B(this.view),this.toggleReadOnly=B(this.view),this.toggleMaxlength=B(this.view)}setTabSize(o){this.toggleTabSize([N.EditorState.tabSize.of(o),z.indentUnit.of(" ".repeat(o))])}setPlaceholder(o){this.togglePlaceholder($.placeholder(o))}focus(o){if(this.view.focus(),!o)return;let a=0,l=0,i=0;switch(o){case"start":break;case"end":{a=l=i=this.getValue().length;break}default:a=o.rangeAnchor||o.cursorPos,l=o.rangeHead||o.cursorPos,i=o.cursorPos}this.view.dispatch({scrollIntoView:!0,selection:N.EditorSelection.create([N.EditorSelection.range(a,l),N.EditorSelection.cursor(i)],1)})}setDisabled(o){this.toggleDisabled([$.EditorView.editable.of(!o)])}setReadOnly(o){this.toggleReadOnly([N.EditorState.readOnly.of(o)])}setMaxLength(o){this.maxLength=o,this.toggleMaxlength([N.EditorState.changeFilter.of(a=>a.newDoc.length<=o)])}}const Qe=(t,o)=>{if(t===o)return!0;if(t.length!==o.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==o[a])return!1;return!0},et=(t,o)=>{const a=e.ref(o.value);e.watch([o],()=>{(!a.value||!Qe(a.value,o.value))&&(a.value=o.value,t())})},Y=(t,o,a,l,i)=>(r,c,d,u)=>{const f=`${t}${o}${a}${l}`,m=d+c.label.length+(i==="title"?a.length:0);r.dispatch({changes:{from:d,to:u,insert:f},selection:N.EditorSelection.create([N.EditorSelection.range(d+c.label.length+(i==="title"?1:-o.length),m),N.EditorSelection.cursor(m)],1)}),r.focus()},de=t=>(o,a,l,i)=>{const r=t.slice(i-l);o.dispatch(o.state.replaceSelection(`${r} `))},ue=t=>{const o=a=>{const l=a.matchBefore(/^#+|^-\s*\[*\s*\]*|`+|\[|!\[*|^\|\s?\|?|\$\$?|!+\s*\w*/);return l===null||l.from==l.to&&a.explicit?null:{from:l.from,options:[...["h2","h3","h4","h5","h6"].map((i,r)=>{const c=new Array(r+2).fill("#").join("");return{label:c,type:"text",apply:de(c)}}),...["unchecked","checked"].map(i=>{const r=i==="checked"?"- [x]":"- [ ]";return{label:r,type:"text",apply:de(r)}}),...[["`",""],["```","language"],["```mermaid\n",""],["```echarts\n",""]].map(i=>({label:`${i[0]}${i[1]}`,type:"text",apply:Y(i[0],i[1],"",i[0]==="`"?"`":"\n```","type")})),{label:"[]()",type:"text"},{label:"![]()",type:"text"},{label:"| |",type:"text",detail:"table",apply:`| col | col | col |
| - | - | - |
| content | content | content |
| content | content | content |`},{label:"$",type:"text",apply:Y("$","","","$","type")},{label:"$$",type:"text",apply:Y("$$","",`
`,`
$$`,"title")},...["note","abstract","info","tip","success","question","warning","failure","danger","bug","example","quote","hint","caution","error","attention"].map(i=>({label:`!!! ${i}`,type:"text",apply:Y("!!!",` ${i}`," Title",`

!!!`,"title")}))]}};return Me.autocompletion({override:t?[o,...t]:[o]})},tt=e.defineComponent({name:`${n.prefix}-divider`,setup(){return()=>e.createVNode("div",{class:`${n.prefix}-divider`},null)}}),ot=e.defineComponent({name:"ToolbarBold",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.bold,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"bold")},type:"button"},[e.createVNode(C.Icon,{name:"bold"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.bold])])}}),at=e.defineComponent({name:"ToolbarCatalog",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName"),i=e.inject("catalogVisible");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,i.value&&`${n.prefix}-toolbar-active`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.catalog,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.CHANGE_CATALOG_VISIBLE)},key:"bar-catalog",type:"button"},[e.createVNode(C.Icon,{name:"catalog"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.catalog])])}}),nt=e.defineComponent({name:"ToolbarCode",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.code,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"code")},type:"button"},[e.createVNode(C.Icon,{name:"code"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.code])])}}),lt=e.defineComponent({name:"ToolbarCodeRow",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.codeRow,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"codeRow")},type:"button"},[e.createVNode(C.Icon,{name:"code-row"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.codeRow])])}}),rt=e.defineComponent({name:"ToolbarFullscreen",setup(){const t=e.inject("usedLanguageText"),o=e.inject("disabled"),a=e.inject("showToolbarName"),l=e.inject("setting"),{fullscreenHandler:i}=Ft();return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,l.value.fullscreen&&`${n.prefix}-toolbar-active`,o?.value&&`${n.prefix}-disabled`],title:t.value.toolbarTips?.fullscreen,disabled:o?.value,onClick:()=>{i()},type:"button"},[e.createVNode(C.Icon,{name:l.value.fullscreen?"fullscreen-exit":"fullscreen"},null),a?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[t.value.toolbarTips?.fullscreen])])}}),it=e.defineComponent({name:"ToolbarGithub",setup(){const t=e.inject("usedLanguageText"),o=e.inject("disabled"),a=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,o?.value&&`${n.prefix}-disabled`],title:t.value.toolbarTips?.github,disabled:o?.value,onClick:()=>{W.linkTo("https://github.com/imzbf/md-editor-v3")},type:"button"},[e.createVNode(C.Icon,{name:"github"},null),a?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[t.value.toolbarTips?.github])])}}),st=e.defineComponent({name:"ToolbarHtmlPreview",setup(){const t=e.inject("usedLanguageText"),o=e.inject("disabled"),a=e.inject("showToolbarName"),l=e.inject("setting"),i=e.inject("updateSetting");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,l.value.htmlPreview&&`${n.prefix}-toolbar-active`,o?.value&&`${n.prefix}-disabled`],title:t.value.toolbarTips?.htmlPreview,disabled:o?.value,onClick:()=>{i("htmlPreview")},type:"button"},[e.createVNode(C.Icon,{name:"preview-html"},null),a?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[t.value.toolbarTips?.htmlPreview])])}}),ct=e.defineComponent({name:"ToolbarImage",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.image,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"image")},type:"button"},[e.createVNode(C.Icon,{name:"image"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.image])])}}),dt={visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},ut=e.defineComponent({name:`${n.prefix}-modal-clip`,props:dt,setup(t){const o=e.inject("usedLanguageText"),a=e.inject("editorId"),l=e.inject("rootRef");let i=n.globalConfig.editorExtensions.cropper.instance;const r=e.ref(),c=e.ref(),d=e.ref(),u=e.reactive({cropperInited:!1,imgSelected:!1,imgSrc:"",isFullscreen:!1});let f=null;e.watch(()=>t.visible,()=>{t.visible&&!u.cropperInited&&(i=i||window.Cropper,r.value.onchange=()=>{if(!i){s.bus.emit(a,s.ERROR_CATCHER,{name:"Cropper",message:"Cropper is undefined"});return}const g=r.value.files||[];if(u.imgSelected=!0,g?.length>0){const p=new FileReader;p.onload=v=>{u.imgSrc=v.target.result},p.readAsDataURL(g[0])}})}),e.watch(()=>[u.imgSelected],()=>{d.value.style=""}),e.watch([e.toRef(()=>u.isFullscreen),e.toRef(()=>u.imgSrc)],()=>{u.imgSrc&&e.nextTick(()=>{f?.destroy(),d.value.style="",c.value&&(f=new i(c.value,{viewMode:2,preview:l.value.getRootNode().querySelector(`.${n.prefix}-clip-preview-target`)}))})});const m=()=>{f.clear(),f.destroy(),f=null,r.value.value="",u.imgSelected=!1,u.imgSrc=""};return()=>e.createVNode(C.MdModal,{class:`${n.prefix}-modal-clip`,title:o.value.clipModalTips?.title,visible:t.visible,onClose:t.onCancel,showAdjust:!0,isFullscreen:u.isFullscreen,onAdjust:g=>{u.isFullscreen=g},width:"668px",height:"421px"},{default:()=>[e.createVNode("div",{class:`${n.prefix}-form-item ${n.prefix}-clip`},[e.createVNode("div",{class:`${n.prefix}-clip-main`},[u.imgSelected?e.createVNode("div",{class:`${n.prefix}-clip-cropper`},[e.createVNode("img",{src:u.imgSrc,ref:c,style:{display:"none"},alt:""},null),e.createVNode("div",{class:`${n.prefix}-clip-delete`,onClick:m},[e.createVNode(C.Icon,{name:"delete"},null)])]):e.createVNode("div",{class:`${n.prefix}-clip-upload`,onClick:()=>{r.value.click()},role:"button",tabindex:"0","aria-label":o.value.imgTitleItem?.upload},[e.createVNode(C.Icon,{name:"upload"},null)])]),e.createVNode("div",{class:`${n.prefix}-clip-preview`},[e.createVNode("div",{class:`${n.prefix}-clip-preview-target`,ref:d},null)])]),e.createVNode("div",{class:`${n.prefix}-form-item`},[e.createVNode("button",{class:`${n.prefix}-btn`,type:"button",onClick:()=>{if(f){const g=f.getCroppedCanvas();s.bus.emit(a,s.UPLOAD_IMAGE,[Fe.base642File(g.toDataURL("image/png"))],t.onOk),m()}}},[o.value.clipModalTips?.buttonUpload||o.value.linkModalTips?.buttonOK])]),e.createVNode("input",{ref:r,accept:"image/*",type:"file",multiple:!1,style:{display:"none"},"aria-hidden":"true"},null)]})}}),mt={clipVisible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},bt=e.defineComponent({name:`${n.prefix}-modals`,props:mt,setup(t){return()=>e.createVNode(ut,{visible:t.clipVisible,onOk:t.onOk,onCancel:t.onCancel},null)}}),ft=e.defineComponent({name:"ToolbarImageDropdown",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName"),i=`${t}-toolbar-wrapper`,r=e.ref(!1),c=e.ref(!1),d=e.ref(),u=()=>{s.bus.emit(t,s.UPLOAD_IMAGE,Array.from(d.value.files||[])),d.value.value=""},f=(m,g)=>{a?.value||s.bus.emit(t,s.REPLACE,m,g)};return e.onMounted(()=>{d.value.addEventListener("change",u)}),()=>e.createVNode(e.Fragment,null,[e.createVNode("label",{for:`${i}_label`,style:{display:"none"},"aria-label":o.value.imgTitleItem?.upload},null),e.createVNode("input",{id:`${i}_label`,ref:d,accept:"image/*",type:"file",multiple:!0,style:{display:"none"}},null),e.createVNode(H.Dropdown,{relative:`#${i}`,visible:r.value,onChange:m=>{r.value=m},disabled:a?.value,overlay:e.createVNode("ul",{class:`${n.prefix}-menu`,onClick:()=>{r.value=!1},role:"menu"},[e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-image`,onClick:()=>{f("image")},role:"menuitem",tabindex:"0"},[o.value.imgTitleItem?.link]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-image`,onClick:()=>{d.value.click()},role:"menuitem",tabindex:"0"},[o.value.imgTitleItem?.upload]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-image`,onClick:()=>{c.value=!0},role:"menuitem",tabindex:"0"},[o.value.imgTitleItem?.clip2upload])])},{default:()=>[e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.image,disabled:a?.value,type:"button"},[e.createVNode(C.Icon,{name:"image"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.image])])]}),e.createVNode(bt,{clipVisible:c.value,onCancel:()=>{c.value=!1},onOk:m=>{m&&f("image",{desc:m.desc,url:m.url,transform:!0}),c.value=!1}},null)])}}),pt=e.defineComponent({name:"ToolbarItalic",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.italic,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"italic")},type:"button"},[e.createVNode(C.Icon,{name:"italic"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.italic])])}}),gt=e.defineComponent({name:"ToolbarKatex",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName"),i=`${t}-toolbar-wrapper`,r=e.ref(!1),c=d=>{a?.value||s.bus.emit(t,s.REPLACE,d)};return()=>e.createVNode(H.Dropdown,{relative:`#${i}`,visible:r.value,onChange:d=>{r.value=d},disabled:a?.value,overlay:e.createVNode("ul",{class:`${n.prefix}-menu`,onClick:()=>{r.value=!1},role:"menu"},[e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-katex`,onClick:()=>{c("katexInline")},role:"menuitem",tabindex:"0"},[o.value.katex?.inline]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-katex`,onClick:()=>{c("katexBlock")},role:"menuitem",tabindex:"0"},[o.value.katex?.block])]),key:"bar-katex"},{default:()=>[e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.katex,disabled:a?.value,type:"button"},[e.createVNode(C.Icon,{name:"formula"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.katex])])]})}}),vt=e.defineComponent({name:"ToolbarLink",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.link,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"link")},type:"button"},[e.createVNode(C.Icon,{name:"link"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.link])])}}),ht=e.defineComponent({name:"ToolbarMermaid",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName"),i=`${t}-toolbar-wrapper`,r=e.ref(!1),c=d=>{a?.value||s.bus.emit(t,s.REPLACE,d)};return()=>e.createVNode(H.Dropdown,{relative:`#${i}`,visible:r.value,onChange:d=>{r.value=d},disabled:a?.value,overlay:e.createVNode("ul",{class:`${n.prefix}-menu`,onClick:()=>{r.value=!1},role:"menu"},[e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-mermaid`,onClick:()=>{c("flow")},role:"menuitem",tabindex:"0"},[o.value.mermaid?.flow]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-mermaid`,onClick:()=>{c("sequence")},role:"menuitem",tabindex:"0"},[o.value.mermaid?.sequence]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-mermaid`,onClick:()=>{c("gantt")},role:"menuitem",tabindex:"0"},[o.value.mermaid?.gantt]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-mermaid`,onClick:()=>{c("class")},role:"menuitem",tabindex:"0"},[o.value.mermaid?.class]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-mermaid`,onClick:()=>{c("state")},role:"menuitem",tabindex:"0"},[o.value.mermaid?.state]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-mermaid`,onClick:()=>{c("pie")},role:"menuitem",tabindex:"0"},[o.value.mermaid?.pie]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-mermaid`,onClick:()=>{c("relationship")},role:"menuitem",tabindex:"0"},[o.value.mermaid?.relationship]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-mermaid`,onClick:()=>{c("journey")},role:"menuitem",tabindex:"0"},[o.value.mermaid?.journey])]),key:"bar-mermaid"},{default:()=>[e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.mermaid,disabled:a?.value,type:"button"},[e.createVNode(C.Icon,{name:"mermaid"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.mermaid])])]})}}),xt=e.defineComponent({name:"ToolbarNext",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.next,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.CTRL_SHIFT_Z)},type:"button"},[e.createVNode(C.Icon,{name:"next"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.next])])}}),Tt=e.defineComponent({name:"ToolbarOrderedList",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.orderedList,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"orderedList")},type:"button"},[e.createVNode(C.Icon,{name:"ordered-list"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.orderedList])])}}),Ct=e.defineComponent({name:"ToolbarPageFullscreen",setup(){const t=e.inject("usedLanguageText"),o=e.inject("disabled"),a=e.inject("showToolbarName"),l=e.inject("setting"),i=e.inject("updateSetting");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,l.value.pageFullscreen&&`${n.prefix}-toolbar-active`,o?.value&&`${n.prefix}-disabled`],title:t.value.toolbarTips?.pageFullscreen,disabled:o?.value,onClick:()=>{i("pageFullscreen")},type:"button"},[e.createVNode(C.Icon,{name:l.value.pageFullscreen?"minimize":"maximize"},null),a?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[t.value.toolbarTips?.pageFullscreen])])}}),wt=e.defineComponent({name:"ToolbarPrettier",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.prettier,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"prettier")},type:"button"},[e.createVNode(C.Icon,{name:"prettier"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.prettier])])}}),yt=e.defineComponent({name:"ToolbarPreview",setup(){const t=e.inject("usedLanguageText"),o=e.inject("disabled"),a=e.inject("showToolbarName"),l=e.inject("setting"),i=e.inject("updateSetting");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,l.value.preview&&`${n.prefix}-toolbar-active`,o?.value&&`${n.prefix}-disabled`],title:t.value.toolbarTips?.preview,disabled:o?.value,onClick:()=>{i("preview")},type:"button"},[e.createVNode(C.Icon,{name:"preview"},null),a?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[t.value.toolbarTips?.preview])])}}),Nt=e.defineComponent({name:"ToolbarPreviewOnly",setup(){const t=e.inject("usedLanguageText"),o=e.inject("disabled"),a=e.inject("showToolbarName"),l=e.inject("setting"),i=e.inject("updateSetting");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,l.value.previewOnly&&`${n.prefix}-toolbar-active`,o?.value&&`${n.prefix}-disabled`],title:t.value.toolbarTips?.previewOnly,disabled:o?.value,onClick:()=>{i("previewOnly")},type:"button"},[e.createVNode(C.Icon,{name:"preview-only"},null),a?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[t.value.toolbarTips?.previewOnly])])}}),kt=e.defineComponent({name:"ToolbarQuote",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.quote,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"quote")},type:"button"},[e.createVNode(C.Icon,{name:"quote"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.quote])])}}),$t=e.defineComponent({name:"ToolbarRevoke",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.revoke,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.CTRL_Z)},type:"button"},[e.createVNode(C.Icon,{name:"revoke"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.revoke])])}}),Et=e.defineComponent({name:"ToolbarSave",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.save,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.ON_SAVE)},type:"button"},[e.createVNode(C.Icon,{name:"save"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.save])])}}),Vt=e.defineComponent({name:"ToolbarStrikeThrough",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.strikeThrough,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"strikeThrough")},type:"button"},[e.createVNode(C.Icon,{name:"strike-through"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.strikeThrough])])}}),St=e.defineComponent({name:"ToolbarSub",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.sub,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"sub")},type:"button"},[e.createVNode(C.Icon,{name:"sub"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.sub])])}}),It=e.defineComponent({name:"ToolbarSup",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.sup,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"sup")},type:"button"},[e.createVNode(C.Icon,{name:"sup"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.sup])])}}),Lt={tableShape:{type:Array,default:()=>[6,4]},onSelected:{type:Function,default:()=>{}}},jt=e.defineComponent({name:"TableShape",props:Lt,setup(t){const o=e.reactive({x:-1,y:-1}),a=e.computed(()=>JSON.stringify(t.tableShape)),l=()=>{const r=[...JSON.parse(a.value)];return(!r[2]||r[2]<r[0])&&(r[2]=r[0]),(!r[3]||r[3]<r[3])&&(r[3]=r[1]),r},i=e.ref(l());return e.watch([a],()=>{i.value=l()}),()=>e.createVNode("div",{class:`${n.prefix}-table-shape`,onMouseleave:()=>{i.value=l(),o.x=-1,o.y=-1}},[new Array(i.value[1]).fill("").map((r,c)=>e.createVNode("div",{class:`${n.prefix}-table-shape-row`,key:`table-shape-row-${c}`},[new Array(i.value[0]).fill("").map((d,u)=>e.createVNode("div",{class:`${n.prefix}-table-shape-col`,key:`table-shape-col-${u}`,onMouseenter:()=>{o.x=c,o.y=u,u+1===i.value[0]&&u+1<i.value[2]?i.value[0]++:u+2<i.value[0]&&i.value[0]>t.tableShape[0]&&i.value[0]--,c+1===i.value[1]&&c+1<i.value[3]?i.value[1]++:c+2<i.value[1]&&i.value[1]>t.tableShape[1]&&i.value[1]--},onClick:()=>{t.onSelected(o)}},[e.createVNode("div",{class:[`${n.prefix}-table-shape-col-default`,c<=o.x&&u<=o.y&&`${n.prefix}-table-shape-col-include`]},null)]))]))])}}),At=e.defineComponent({name:"ToolbarTable",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName"),i=e.inject("tableShape"),r=`${t}-toolbar-wrapper`,c=e.ref(!1);return()=>e.createVNode(H.Dropdown,{relative:`#${r}`,visible:c.value,onChange:d=>{c.value=d},disabled:a?.value,key:"bar-table",overlay:e.createVNode(jt,{tableShape:i.value,onSelected:d=>{a?.value||s.bus.emit(t,s.REPLACE,"table",{selectedShape:d})}},null)},{default:()=>[e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.table,disabled:a?.value,type:"button"},[e.createVNode(C.Icon,{name:"table"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.table])])]})}}),Rt=e.defineComponent({name:"ToolbarTask",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.task,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"task")},type:"button"},[e.createVNode(C.Icon,{name:"task"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.task])])}}),Pt=e.defineComponent({name:"ToolbarTitle",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName"),i=`${t}-toolbar-wrapper`,r=e.ref(!1),c=d=>{a?.value||s.bus.emit(t,s.REPLACE,d)};return()=>e.createVNode(H.Dropdown,{relative:`#${i}`,visible:r.value,onChange:d=>{r.value=d},disabled:a?.value,overlay:e.createVNode("ul",{class:`${n.prefix}-menu`,onClick:()=>{r.value=!1},role:"menu"},[e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-title`,onClick:()=>{c("h1")},role:"menuitem",tabindex:"0"},[o.value.titleItem?.h1]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-title`,onClick:()=>{c("h2")},role:"menuitem",tabindex:"0"},[o.value.titleItem?.h2]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-title`,onClick:()=>{c("h3")},role:"menuitem",tabindex:"0"},[o.value.titleItem?.h3]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-title`,onClick:()=>{c("h4")},role:"menuitem",tabindex:"0"},[o.value.titleItem?.h4]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-title`,onClick:()=>{c("h5")},role:"menuitem",tabindex:"0"},[o.value.titleItem?.h5]),e.createVNode("li",{class:`${n.prefix}-menu-item ${n.prefix}-menu-item-title`,onClick:()=>{c("h6")},role:"menuitem",tabindex:"0"},[o.value.titleItem?.h6])])},{default:()=>[e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],disabled:a?.value,title:o.value.toolbarTips?.title,type:"button"},[e.createVNode(C.Icon,{name:"title"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.title])])]})}}),Mt=e.defineComponent({name:"ToolbarUnderline",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.underline,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"underline")},type:"button"},[e.createVNode(C.Icon,{name:"underline"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.underline])])}}),Dt=e.defineComponent({name:"ToolbarUnorderedList",setup(){const t=e.inject("editorId"),o=e.inject("usedLanguageText"),a=e.inject("disabled"),l=e.inject("showToolbarName");return()=>e.createVNode("button",{class:[`${n.prefix}-toolbar-item`,a?.value&&`${n.prefix}-disabled`],title:o.value.toolbarTips?.unorderedList,disabled:a?.value,onClick:()=>{s.bus.emit(t,s.REPLACE,"unorderedList")},type:"button"},[e.createVNode(C.Icon,{name:"unordered-list"},null),l?.value&&e.createVNode("div",{class:`${n.prefix}-toolbar-item-name`},[o.value.toolbarTips?.unorderedList])])}}),Ft=()=>{const t=e.inject("editorId"),o=e.inject("setting"),a=e.inject("updateSetting"),{editorExtensions:l,editorExtensionsAttrs:i}=n.globalConfig;let r=l.screenfull.instance;const c=e.ref(!1),d=m=>{if(!r){s.bus.emit(t,s.ERROR_CATCHER,{name:"fullscreen",message:"fullscreen is undefined"});return}r.isEnabled?(c.value=!0,(m===void 0?!r.isFullscreen:m)?r.request():r.exit()):console.error("browser does not support screenfull!")},u=()=>{r&&r.isEnabled&&r.on("change",()=>{(c.value||o.value.fullscreen)&&(c.value=!1,a("fullscreen"))})},f=()=>{r=window.screenfull,u()};return e.onMounted(()=>{u(),r||De.appendHandler("script",{...i.screenfull?.js,src:l.screenfull.js,id:S.CDN_IDS.screenfull,onload:f},"screenfull")}),e.onMounted(()=>{s.bus.on(t,{name:s.CHANGE_FULL_SCREEN,callback:d})}),{fullscreenHandler:d}};let Bt=0;const ke=()=>{const t=e.inject("editorId"),o=e.inject("theme"),a=e.inject("previewTheme"),l=e.inject("language"),i=e.inject("disabled"),r=e.inject("noUploadImg"),c=e.inject("noPrettier"),d=e.inject("codeTheme"),u=e.inject("showToolbarName"),f=e.inject("setting"),m=e.inject("defToolbars");return{barRender:p=>{if(n.allToolbar.includes(p))switch(p){case"-":return e.createVNode(tt,{key:`bar-${Bt++}`},null);case"bold":return e.createVNode(ot,{key:"bar-bold"},null);case"underline":return e.createVNode(Mt,{key:"bar-unorderline"},null);case"italic":return e.createVNode(pt,{key:"bar-italic"},null);case"strikeThrough":return e.createVNode(Vt,{key:"bar-strikeThrough"},null);case"title":return e.createVNode(Pt,{key:"bar-title"},null);case"sub":return e.createVNode(St,{key:"bar-sub"},null);case"sup":return e.createVNode(It,{key:"bar-sup"},null);case"quote":return e.createVNode(kt,{key:"bar-quote"},null);case"unorderedList":return e.createVNode(Dt,{key:"bar-unorderedList"},null);case"orderedList":return e.createVNode(Tt,{key:"bar-orderedList"},null);case"task":return e.createVNode(Rt,{key:"bar-task"},null);case"codeRow":return e.createVNode(lt,{key:"bar-codeRow"},null);case"code":return e.createVNode(nt,{key:"bar-code"},null);case"link":return e.createVNode(vt,{key:"bar-link"},null);case"image":return r?e.createVNode(ct,{key:"bar-image"},null):e.createVNode(ft,{key:"bar-imageDropdown"},null);case"table":return e.createVNode(At,{key:"bar-table"},null);case"revoke":return e.createVNode($t,{key:"bar-revoke"},null);case"next":return e.createVNode(xt,{key:"bar-next"},null);case"save":return e.createVNode(Et,{key:"bar-save"},null);case"prettier":return!c&&e.createVNode(wt,{key:"bar-prettier"},null);case"pageFullscreen":return!f.value.fullscreen&&e.createVNode(Ct,{key:"bar-pageFullscreen"},null);case"fullscreen":return e.createVNode(rt,{key:"bar-fullscreen"},null);case"catalog":return e.createVNode(at,{key:"bar-catalog"},null);case"preview":return e.createVNode(yt,{key:"bar-preview"},null);case"previewOnly":return e.createVNode(Nt,{key:"bar-previewOnly"},null);case"htmlPreview":return e.createVNode(st,{key:"bar-htmlPreview"},null);case"github":return e.createVNode(it,{key:"bar-github"},null);case"mermaid":return e.createVNode(ht,{key:"bar-mermaid"},null);case"katex":return e.createVNode(gt,{key:"bar-katex"},null)}else if(m.value instanceof Array){const v=m.value[p];return v?e.cloneVNode(v,{theme:v.props?.theme||o.value,previewTheme:v.props?.theme||a.value,language:v.props?.theme||l.value,codeTheme:v.props?.codeTheme||d.value,disabled:v.props?.disabled||i.value,showToolbarName:v.props?.showToolbarName||u.value,insert(y){s.bus.emit(t,s.REPLACE,"universal",{generate:y})}}):""}else if(m.value?.children instanceof Array){const v=m.value.children[p];return v?e.cloneVNode(v,{theme:v.props?.theme||o.value,previewTheme:v.props?.theme||a.value,language:v.props?.theme||l.value,codeTheme:v.props?.codeTheme||d.value,disabled:v.props?.disabled||i.value,showToolbarName:v.props?.showToolbarName||u.value,insert(y){s.bus.emit(t,s.REPLACE,"universal",{generate:y})}}):""}else return""}}},Ht=e.defineComponent({name:"FloatingToolbar",setup(){const t=e.inject("floatingToolbars"),{barRender:o}=ke();return()=>e.createVNode("div",{class:`${n.prefix}-floating-toolbar`},[t.value.map(a=>o(a))])}}),ae=N.StateEffect.define(),Ot=N.StateField.define({create(){return null},update(t,o){for(const a of o.effects)a.is(ae)&&(t=a.value);return t},provide:t=>$.showTooltip.from(t)}),_t=t=>{const o=(l,i)=>{l.dispatch({effects:ae.of({pos:i,above:!0,arrow:!0,create:()=>{const r=document.createElement("div"),c=document.createElement("div");r.appendChild(c);const d=e.createApp(Ht);return t.privide(d),d.mount(r),{dom:r,destroy:()=>d.unmount()}}})})},a=$.EditorView.updateListener.of(l=>{if(l.selectionSet||l.docChanged){const i=l.state,r=i.selection.main;if(!r.empty)o(l.view,r.from);else{const c=r.head,d=i.doc.lineAt(c);/^\s*$/.test(d.text)?o(l.view,c):l.view.dispatch({effects:ae.of(null)})}}});return[Ot,a]},qt="#e5c07b",me="var(--md-color)",Wt="#56b6c2",zt="#fff",_="#3f4a54",be="#2d8cf0",Ut="#2d8cf0",Kt="#3f4a54",fe="#d19a66",Gt="#c678dd",Yt="#f6f6f6",Zt="#ceedfa33",pe="var(--md-bk-color)",ee="var(--md-bk-color)",Xt="#bad5fa",ge="#3f4a54",Jt=$.EditorView.theme({"&":{color:_,backgroundColor:pe},".cm-content":{caretColor:ge},".cm-cursor, .cm-dropCursor":{borderLeftColor:ge},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Xt},".cm-panels":{backgroundColor:Yt,color:_},".cm-panels.cm-panels-top":{borderBottom:"1px solid var(--md-border-color)"},".cm-panels.cm-panels-bottom":{borderTop:"1px solid var(--md-border-color)"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:pe,color:_,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:Zt},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:ee},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"var(--md-border-color)",borderBottomColor:"var(--md-border-color)"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:ee,borderBottomColor:ee},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:_}}}),Qt=z.HighlightStyle.define([{tag:b.tags.keyword,color:Gt},{tag:[b.tags.name,b.tags.deleted,b.tags.character,b.tags.propertyName,b.tags.macroName],color:me},{tag:[b.tags.function(b.tags.variableName),b.tags.labelName],color:Ut},{tag:[b.tags.color,b.tags.constant(b.tags.name),b.tags.standard(b.tags.name)],color:fe},{tag:[b.tags.definition(b.tags.name),b.tags.separator],color:_},{tag:[b.tags.typeName,b.tags.className,b.tags.number,b.tags.changed,b.tags.annotation,b.tags.modifier,b.tags.self,b.tags.namespace],color:qt},{tag:[b.tags.operator,b.tags.operatorKeyword,b.tags.url,b.tags.escape,b.tags.regexp,b.tags.link,b.tags.special(b.tags.string)],color:Wt},{tag:[b.tags.meta,b.tags.comment],color:be},{tag:b.tags.strong,fontWeight:"bold"},{tag:b.tags.emphasis,fontStyle:"italic"},{tag:b.tags.strikethrough,textDecoration:"line-through"},{tag:b.tags.link,color:be,textDecoration:"underline"},{tag:b.tags.heading,fontWeight:"bold",color:me},{tag:[b.tags.atom,b.tags.bool,b.tags.special(b.tags.variableName)],color:fe},{tag:[b.tags.processingInstruction,b.tags.string,b.tags.inserted],color:Kt},{tag:b.tags.invalid,color:zt}]),ve=[Jt,z.syntaxHighlighting(Qt)],eo="#e5c07b",he="var(--md-color)",to="#56b6c2",oo="#ffffff",q="var(--md-color)",xe="#e5c07b",ao="#e5c07b",no="var(--md-color)",Te="#d19a66",lo="#c678dd",ro="#21252b",io="#2c313a",Ce="var(--md-bk-color)",te="var(--md-bk-color)",so="#ceedfa33",we="#528bff",co=$.EditorView.theme({"&":{color:q,backgroundColor:Ce},".cm-content":{caretColor:we},".cm-cursor, .cm-dropCursor":{borderLeftColor:we},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:so},".cm-panels":{backgroundColor:ro,color:q},".cm-panels.cm-panels-top":{borderBottom:"1px solid var(--md-border-color)"},".cm-panels.cm-panels-bottom":{borderTop:"1px solid var(--md-border-color)"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:Ce,color:q,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:io},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:te},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"var(--md-border-color)",borderBottomColor:"var(--md-border-color)"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:te,borderBottomColor:te},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:q}}},{dark:!0}),uo=z.HighlightStyle.define([{tag:b.tags.keyword,color:lo},{tag:[b.tags.name,b.tags.deleted,b.tags.character,b.tags.propertyName,b.tags.macroName],color:he},{tag:[b.tags.function(b.tags.variableName),b.tags.labelName],color:ao},{tag:[b.tags.color,b.tags.constant(b.tags.name),b.tags.standard(b.tags.name)],color:Te},{tag:[b.tags.definition(b.tags.name),b.tags.separator],color:q},{tag:[b.tags.typeName,b.tags.className,b.tags.number,b.tags.changed,b.tags.annotation,b.tags.modifier,b.tags.self,b.tags.namespace],color:eo},{tag:[b.tags.operator,b.tags.operatorKeyword,b.tags.url,b.tags.escape,b.tags.regexp,b.tags.link,b.tags.special(b.tags.string)],color:to},{tag:[b.tags.meta,b.tags.comment],color:xe},{tag:b.tags.strong,fontWeight:"bold"},{tag:b.tags.emphasis,fontStyle:"italic"},{tag:b.tags.strikethrough,textDecoration:"line-through"},{tag:b.tags.link,color:xe,textDecoration:"underline"},{tag:b.tags.heading,fontWeight:"bold",color:he},{tag:[b.tags.atom,b.tags.bool,b.tags.special(b.tags.variableName)],color:Te},{tag:[b.tags.processingInstruction,b.tags.string,b.tags.inserted],color:no},{tag:b.tags.invalid,color:oo}]),ye=[co,z.syntaxHighlighting(uo)],mo=(t,o)=>{const a=e.inject("editorId"),l=r=>{r instanceof Promise?r.then(c=>{s.bus.emit(a,s.REPLACE,"universal",{generate(){return{targetValue:c}}})}).catch(c=>{console.error(c)}):s.bus.emit(a,s.REPLACE,"universal",{generate(){return{targetValue:r}}})};return r=>{if(!r.clipboardData)return;if(r.clipboardData.files.length>0){const{files:p}=r.clipboardData;s.bus.emit(a,s.UPLOAD_IMAGE,Array.from(p).filter(v=>/image\/.*/.test(v.type))),r.preventDefault();return}const c=r.clipboardData.getData("text/plain"),d=o.value?.view.state.selection.main.to||0,u=o.value?.view.state.doc.lineAt(d).from||0,f=o.value?.view.state.doc.sliceString(u,d)||"",m=/!\[.*\]\(\s*$/.test(f),g=/!\[.*\]\((.*)\s?.*\)/.test(c);if(m){const p=t.transformImgUrl(c);l(p),r.preventDefault();return}else if(g){const p=c.match(new RegExp(`(?<=!\\[.*\\]\\()([^)\\s]+)(?=\\s?["']?.*["']?\\))`,"g"));p?Promise.all(p.map(v=>t.transformImgUrl(v))).then(v=>{l(v.reduce((h,y,V)=>h.replace(p[V],y),c))}).catch(v=>{console.error(v)}):l(c),r.preventDefault();return}if(t.autoDetectCode&&r.clipboardData.types.includes("vscode-editor-data")){const p=JSON.parse(r.clipboardData.getData("vscode-editor-data"));s.bus.emit(a,s.REPLACE,"code",{mode:p.mode,text:r.clipboardData.getData("text/plain")}),r.preventDefault();return}t.maxlength&&c.length+t.modelValue.length>t.maxlength&&s.bus.emit(a,s.ERROR_CATCHER,{name:"overlength",message:"The input text is too long",data:c})}},bo=(t,o)=>{const a={key:"Ctrl-b",mac:"Cmd-b",run:()=>(s.bus.emit(t,s.REPLACE,"bold"),!0)},l={key:"Ctrl-s",mac:"Cmd-s",run:L=>(s.bus.emit(t,s.ON_SAVE,L.state.doc.toString()),!0),shift:()=>(s.bus.emit(t,s.REPLACE,"strikeThrough"),!0)},i={key:"Ctrl-u",mac:"Cmd-u",preventDefault:!0,run:()=>(s.bus.emit(t,s.REPLACE,"underline"),!0),shift:()=>(s.bus.emit(t,s.REPLACE,"unorderedList"),!0)},r={key:"Ctrl-i",mac:"Cmd-i",preventDefault:!0,run:()=>(s.bus.emit(t,s.REPLACE,"italic"),!0),shift:()=>(s.bus.emit(t,s.REPLACE,"image"),!0)},c={key:"Ctrl-1",mac:"Cmd-1",run:()=>(s.bus.emit(t,s.REPLACE,"h1"),!0)},d={key:"Ctrl-2",mac:"Cmd-2",run:()=>(s.bus.emit(t,s.REPLACE,"h2"),!0)},u={key:"Ctrl-3",mac:"Cmd-3",run:()=>(s.bus.emit(t,s.REPLACE,"h3"),!0)},f={key:"Ctrl-4",mac:"Cmd-4",run:()=>(s.bus.emit(t,s.REPLACE,"h4"),!0)},m={key:"Ctrl-5",mac:"Cmd-5",run:()=>(s.bus.emit(t,s.REPLACE,"h5"),!0)},g={key:"Ctrl-6",mac:"Cmd-6",run:()=>(s.bus.emit(t,s.REPLACE,"h6"),!0)},p={key:"Ctrl-ArrowUp",mac:"Cmd-ArrowUp",run:()=>(s.bus.emit(t,s.REPLACE,"sup"),!0)},v={key:"Ctrl-ArrowDown",mac:"Cmd-ArrowDown",run:()=>(s.bus.emit(t,s.REPLACE,"sub"),!0)},h={key:"Ctrl-o",mac:"Cmd-o",run:()=>(s.bus.emit(t,s.REPLACE,"orderedList"),!0)},y={key:"Ctrl-c",mac:"Cmd-c",shift:()=>(s.bus.emit(t,s.REPLACE,"code"),!0),any(L,T){return(T.ctrlKey||T.metaKey)&&T.altKey&&T.code==="KeyC"?(s.bus.emit(t,s.REPLACE,"codeRow"),!0):!1}},V={key:"Ctrl-l",mac:"Cmd-l",run:()=>(s.bus.emit(t,s.REPLACE,"link"),!0)},k={key:"Ctrl-f",mac:"Cmd-f",shift:()=>o.noPrettier?!1:(s.bus.emit(t,s.REPLACE,"prettier"),!0)},w={any:(L,T)=>(T.ctrlKey||T.metaKey)&&T.altKey&&T.shiftKey&&T.code==="KeyT"?(s.bus.emit(t,s.REPLACE,"table"),!0):!1},E={key:"Ctrl-d",mac:"Cmd-d",run:F.deleteLine,preventDefault:!0};return[a,E,l,i,r,c,d,u,f,m,g,p,v,h,y,V,k,w,...Be.searchKeymap]},fo=/[a-z][a-z0-9.+-]*:\/\/[^\s<>"'`()]+(?:\([^\s<>"'`]*\)[^\s<>"'`]*)*/i,po=/\/\/[^\s<>"'`()]+/i,go=/data:[a-z]+\/[a-z0-9.+-]+(?:;base64)?,[a-z0-9+/=%]+/i,vo=/\/(?!\/)[^\s<>"'`()]+/i,Ne=new RegExp(`(?<![a-z0-9.+-])(${fo.source}|${po.source}|${go.source}|${vo.source})`,"gi"),ho=(t,o,a)=>t.some(l=>l.from===o&&l.to===a),xo=t=>{const o=t.shortenText||(()=>"..."),a=N.StateEffect.define(),l=N.StateEffect.define(),i=(u,f)=>{const m=new N.RangeSetBuilder,g=[];for(let p=1;p<=u.doc.lines;p++){const v=u.doc.line(p),h=v.text;Ne.lastIndex=0;let y;for(;y=Ne.exec(h);){if(!y[0])continue;const V=y[0];if(V.length<=t.maxLength)continue;const k=v.from+y.index,w=k+V.length;if(ho(f,k,w)){g.push({from:k,to:w});continue}const E=o(V);m.add(k,w,$.Decoration.replace({widget:new r(E,V,k,w)}))}}return{deco:m.finish(),expanded:g}};class r extends $.WidgetType{constructor(f,m,g,p){super(),this.short=f,this.raw=m,this.from=g,this.to=p}toDOM(f){const m=document.createElement("span");return m.textContent=this.short,m.className="cm-short-text",m.title=this.raw,m.style.display="inline",m.style.textDecoration="underline",m.addEventListener("mousedown",g=>{g.preventDefault(),g.stopPropagation(),f.dispatch({selection:N.EditorSelection.cursor(this.from),effects:a.of({from:this.from,to:this.to,expand:!0})}),f.focus()}),m.addEventListener("click",g=>{g.preventDefault()}),m}ignoreEvent(){return!1}eq(f){return this.short===f.short&&this.raw===f.raw&&this.from===f.from&&this.to===f.to}}const c=N.StateField.define({create(u){return i(u,[])},update(u,f){let m=u.expanded;f.docChanged&&m.length&&(m=m.map(({from:p,to:v})=>({from:f.changes.mapPos(p,1),to:f.changes.mapPos(v,-1)})).filter(({from:p,to:v})=>p<v));let g=m!==u.expanded;for(const p of f.effects)p.is(a)?p.value.expand?m=[{from:p.value.from,to:p.value.to}]:m=m.filter(({from:v,to:h})=>v!==p.value.from||h!==p.value.to):p.is(l)&&m.length>0&&(m=[]);return!g&&m!==u.expanded&&(g=!0),f.docChanged||g?i(f.state,m):u},provide:u=>$.EditorView.decorations.compute([u],f=>f.field(u).deco)}),d=$.EditorView.domEventHandlers({mousedown(u,f){const m=f.state.field(c,!1);if(!m||m.expanded.length===0)return!1;const g=u.target;if(g&&f.dom.contains(g)){const p=f.posAtDOM(g,0);if(p!=null&&p!==-1&&m.expanded.some(({from:h,to:y})=>p>=h&&p<=y))return!1}return f.dispatch({effects:l.of(void 0)}),!1}});return[c,d]};$.EditorView.EDIT_CONTEXT=!1;const $e=t=>t.extension instanceof Function?t.extension(t.options):t.extension,To=t=>{const o=$e(t);return t.compartment?t.compartment.of(o):o},Co=t=>{const o=e.inject("tabWidth"),a=e.inject("editorId"),l=e.inject("theme"),i=e.inject("previewTheme"),r=e.inject("language"),c=e.inject("usedLanguageText"),d=e.inject("disabled"),u=e.inject("showToolbarName"),f=e.inject("customIcon"),m=e.inject("noUploadImg"),g=e.inject("tableShape"),p=e.inject("noPrettier"),v=e.inject("codeTheme"),h=e.inject("setting"),y=e.inject("updateSetting"),V=e.inject("catalogVisible"),k=e.inject("defToolbars"),w=e.inject("floatingToolbars"),E=e.inject("rootRef"),L=e.ref(),T=e.shallowRef(),D=e.ref(!1),U=new N.Compartment,K=new N.Compartment,J=new N.Compartment,le=new N.Compartment,Ee=new N.Compartment,Ve=bo(a,{noPrettier:p}),re=()=>[...Ve,...F.defaultKeymap,...F.historyKeymap,F.indentWithTab],G={paste:mo(t,T),blur:t.onBlur,focus:t.onFocus,drop:t.onDrop,compositionstart:()=>{D.value=!0},compositionend:(x,I)=>{D.value=!1,t.updateModelValue(I.state.doc.toString())},input:x=>{t.onInput&&t.onInput(x);const{data:I}=x;t.maxlength&&t.modelValue.length+I.length>t.maxlength&&s.bus.emit(a,s.ERROR_CATCHER,{name:"overlength",message:"The input text is too long",data:I})}},Se=_t({privide(x){x.provide("editorId",a),x.provide("theme",l),x.provide("previewTheme",i),x.provide("language",r),x.provide("disabled",d),x.provide("noUploadImg",m),x.provide("tableShape",g),x.provide("noPrettier",p),x.provide("codeTheme",v),x.provide("showToolbarName",u),x.provide("setting",h),x.provide("updateSetting",y),x.provide("usedLanguageText",c),x.provide("catalogVisible",V),x.provide("defToolbars",k),x.provide("tabWidth",o),x.provide("customIcon",f),x.provide("floatingToolbars",w),x.provide("rootRef",E)}}),Ie=[{type:"theme",extension:({theme:x})=>x.value==="light"?ve:ye,compartment:U,options:{theme:l}},{type:"updateListener",extension:$.EditorView.updateListener.of(x=>{x.docChanged&&(t.onChange(x.state.doc.toString()),D.value||t.updateModelValue(x.state.doc.toString()))})},{type:"domEventHandlers",extension:$.EditorView.domEventHandlers(G),compartment:le},{type:"completions",extension:ue(t.completions),compartment:K},{type:"history",extension:F.history(),compartment:J}],ie=n.globalConfig.codeMirrorExtensions([{type:"lineWrapping",extension:$.EditorView.lineWrapping},{type:"keymap",extension:$.keymap.of(re())},{type:"drawSelection",extension:$.drawSelection()},{type:"markdown",extension:Re.markdown({codeLanguages:Pe.languages})},{type:"linkShortener",extension:x=>xo(x),options:{maxLength:30}},{type:"floatingToolbar",extension:w.value.length>0?Se:[],compartment:Ee}],{editorId:a,theme:l.value,keyBindings:re()}),Le=()=>[...Ie,...ie].map(To);return e.onMounted(()=>{const x=new $.EditorView({doc:t.modelValue,parent:L.value,extensions:Le()}),I=new Je(x);T.value=I,setTimeout(()=>{I.setTabSize(o),I.setDisabled(d.value),I.setReadOnly(t.readonly),t.placeholder&&I.setPlaceholder(t.placeholder),typeof t.maxlength=="number"&&I.setMaxLength(t.maxlength),t.autofocus&&x.focus()},0),s.bus.on(a,{name:s.CTRL_Z,callback(){F.undo(x)}}),s.bus.on(a,{name:s.CTRL_SHIFT_Z,callback(){F.redo(x)}}),s.bus.on(a,{name:s.REPLACE,async callback(A,j={}){if(A==="image"&&j.transform){const R=t.transformImgUrl(j.url);if(R instanceof Promise)R.then(async M=>{const{text:P,options:O}=await Q(A,T.value,{...j,url:M});T.value?.replaceSelectedText(P,O,a)}).catch(M=>{console.error(M)});else{const{text:M,options:P}=await Q(A,T.value,{...j,url:R});T.value?.replaceSelectedText(M,P,a)}}else{const{text:R,options:M}=await Q(A,T.value,j);T.value?.replaceSelectedText(R,M,a)}}}),s.bus.on(a,{name:s.EVENT_LISTENER,callback:W.throttle(A=>{const j={...G},R=Object.keys(G);for(const M in A){const P=M;R.includes(P)?j[P]=(O,se)=>{A[P](O,se),O.defaultPrevented||G[P](O,se)}:j[P]=A[P]}T.value?.view.dispatch({effects:le.reconfigure($.EditorView.domEventHandlers(j))})})}),s.bus.on(a,{name:s.TASK_STATE_CHANGED,callback:(A,j)=>{const R=x.state.doc.line(A);x.dispatch(x.state.update({changes:{from:R.from,to:R.to,insert:j}}))}}),s.bus.on(a,{name:s.SEND_EDITOR_VIEW,callback(){s.bus.emit(a,s.GET_EDITOR_VIEW,x)}}),s.bus.emit(a,s.GET_EDITOR_VIEW,x)}),e.watch(l,()=>{T.value?.view.dispatch({effects:U.reconfigure(l.value==="light"?ve:ye)})},{deep:!0}),e.watch(()=>t.completions,()=>{T.value?.view.dispatch({effects:K.reconfigure(ue(t.completions))})},{deep:!0}),e.watch(()=>t.modelValue,()=>{T.value?.getValue()!==t.modelValue&&T.value?.setValue(t.modelValue)}),e.watch(()=>t.placeholder,()=>{T.value?.setPlaceholder(t.placeholder)}),e.watch([d],()=>{T.value?.setDisabled(d.value)}),e.watch(()=>t.readonly,()=>{T.value?.setDisabled(t.readonly)}),e.watch(()=>t.maxlength,()=>{t.maxlength&&T.value?.setMaxLength(t.maxlength)}),et(()=>{const x=ie.find(I=>I.type==="floatingToolbar");x?.compartment&&(w.value.length>0?T.value?.view.dispatch({effects:x.compartment.reconfigure($e(x))}):T.value?.view.dispatch({effects:x.compartment.reconfigure([])}))},w),{inputWrapperRef:L,codeMirrorUt:T,resetHistory(){T.value?.view.dispatch({effects:J.reconfigure([])}),T.value?.view.dispatch({effects:J.reconfigure(F.history())})}}},wo=(t,o,a)=>{const l=e.inject("setting"),i=e.computed(()=>/px$/.test(`${t.inputBoxWidth}`)?"50%":t.inputBoxWidth),r=e.reactive({resizedWidth:i.value}),c=e.reactive({width:i.value}),d=e.reactive({left:i.value,display:"initial"}),u=g=>{const p=o.value?.offsetWidth||0,v=o.value?.getBoundingClientRect().x||0;let h=g.x-v;h/p<n.MinInputBoxWidth?h=p*n.MinInputBoxWidth:h>p-p*n.MinInputBoxWidth&&(h=p-p*n.MinInputBoxWidth);const y=`${h/p*100}%`;c.width=y,d.left=y,r.resizedWidth=y,t.oninputBoxWidthChange?.(y)},f=g=>{g.target===a.value&&document.addEventListener("mousemove",u)},m=()=>{document.removeEventListener("mousemove",u)};return e.watch([a],()=>{document.removeEventListener("mousedown",f),document.removeEventListener("mouseup",m),document.addEventListener("mousedown",f),document.addEventListener("mouseup",m)}),e.onMounted(()=>{document.addEventListener("mousedown",f),document.addEventListener("mouseup",m)}),e.onBeforeUnmount(()=>{document.removeEventListener("mousedown",f),document.removeEventListener("mouseup",m)}),e.watch([i],([g])=>{r.resizedWidth=g,c.width=g,d.left=g}),e.watch([()=>l.value.htmlPreview,()=>l.value.preview,()=>l.value.previewOnly],()=>{l.value.previewOnly?(c.width="0%",d.display="none"):!l.value.htmlPreview&&!l.value.preview?(c.width="100%",d.display="none"):(c.width=r.resizedWidth,d.display="initial")},{immediate:!0}),{inputWrapperStyle:c,resizeOperateStyle:d}},yo=()=>{const t=e.inject("editorId"),o=e.ref(!0),a=W.createSmoothScroll();return{onCatalogActive:(c,d)=>{const u=document.querySelector(`#${t} .${n.prefix}-catalog-editor`);if(!d||!o.value||!u)return;const f=d.offsetTop-u.scrollTop;(f>100||f<100)&&a(u,d.offsetTop-100)},onMouseenter:()=>o.value=!1,onMouseleave:()=>o.value=!0}},oe=e.defineComponent({name:`${n.prefixHump}CustomScrollbar`,props:{id:{type:String,default:void 0},class:{type:[String,Array],default:void 0},scrollTarget:{type:String,default:void 0},alwaysShowTrack:{type:Boolean,default:!1},onMouseenter:{type:Function,default:()=>{}},onMouseleave:{type:Function,default:()=>{}}},setup(t,{slots:o}){const a=e.ref(null),l=e.ref(null),i=e.ref(null),r=e.ref(null);let c=null,d=null,u=!1,f=0,m=0;const g=()=>{if(!l.value||!a.value||!i.value||!r.value)return;const w=a.value.clientHeight,E=l.value.scrollHeight,L=l.value.scrollTop;if(E<=w){i.value.style.display="none",t.alwaysShowTrack||(r.value.style.display="none");return}else i.value.style.display="block",r.value.style.display="block";const T=w/E,D=Math.max(w*T,20),U=w-D,K=Math.min(L*T,U);i.value.style.height=`${D}px`,i.value.style.top=`${K}px`},p=()=>g(),v=w=>{u=!0,f=w.clientY,m=l.value.scrollTop,document.body.style.userSelect="none"},h=w=>{if(!u||!l.value||!a.value)return;const E=w.clientY-f,L=l.value.scrollHeight/a.value.clientHeight;l.value.scrollTop=m+E*L},y=()=>{u=!1,document.body.style.userSelect=""},V=w=>{l.value&&l.value.removeEventListener("scroll",p),l.value=w,l.value?(l.value.addEventListener("scroll",p),g()):r.value&&!t.alwaysShowTrack&&(r.value.style.display="none")},k=()=>{if(!a.value)return;const w=t.scrollTarget?a.value.querySelector(t.scrollTarget):a.value.firstElementChild;V(w)};return e.onMounted(async()=>{await e.nextTick(),k(),c=new MutationObserver(()=>{d&&cancelAnimationFrame(d),d=requestAnimationFrame(()=>{k()})}),c.observe(a.value,{childList:!0,subtree:!0}),window.addEventListener("resize",g),i.value?.addEventListener("mousedown",v),document.addEventListener("mousemove",h),document.addEventListener("mouseup",y)}),e.onBeforeUnmount(()=>{c?.disconnect(),l.value&&l.value.removeEventListener("scroll",p),window.removeEventListener("resize",g),i.value?.removeEventListener("mousedown",v),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",y)}),()=>e.createVNode("div",{id:t.id,class:[`${n.prefix}-custom-scrollbar`,t.class],ref:a,onMouseenter:t.onMouseenter,onMouseleave:t.onMouseleave},[o.default?.(),e.createVNode("div",{class:`${n.prefix}-custom-scrollbar__track`,ref:r},[e.createVNode("div",{class:`${n.prefix}-custom-scrollbar__thumb`,ref:i},null)])])}}),No=W.createSmoothScroll(),ko=e.defineComponent({name:"MDEditorContent",props:S.contentProps,setup(t,o){const a=e.inject("editorId"),l=e.inject("catalogVisible"),i=e.inject("theme"),r=e.inject("setting"),c=e.ref(""),d=e.ref(),u=e.ref(),{inputWrapperRef:f,codeMirrorUt:m,resetHistory:g}=Co(t),{inputWrapperStyle:p,resizeOperateStyle:v}=wo(t,d,u);He(t,c,m);const{onCatalogActive:h,onMouseenter:y,onMouseleave:V}=yo();return o.expose({getSelectedText(){return m.value?.getSelectedText()},focus(k){m.value?.focus(k)},resetHistory:g,getEditorView(){return m.value?.view}}),()=>e.createVNode("div",{class:`${n.prefix}-content`},[e.createVNode("div",{class:`${n.prefix}-content-wrapper`,ref:d},[e.createVNode(oe,{alwaysShowTrack:!0,scrollTarget:`#${a} .cm-scroller`,style:p},{default:()=>[e.createVNode("div",{class:`${n.prefix}-input-wrapper`,ref:f},null)]}),(r.value.htmlPreview||r.value.preview)&&e.createVNode("div",{class:`${n.prefix}-resize-operate`,style:v,ref:u},null),e.createVNode(oe,{style:{flex:1}},{default:()=>[e.createVNode(S.ContentPreview,{modelValue:t.modelValue,onChange:t.onChange,onHtmlChanged:k=>{c.value=k,t.onHtmlChanged(k)},onGetCatalog:t.onGetCatalog,mdHeadingId:t.mdHeadingId,noMermaid:t.noMermaid,sanitize:t.sanitize,noKatex:t.noKatex,formatCopiedText:t.formatCopiedText,noHighlight:t.noHighlight,noImgZoomIn:t.noImgZoomIn,sanitizeMermaid:t.sanitizeMermaid,codeFoldable:t.codeFoldable,autoFoldThreshold:t.autoFoldThreshold,onRemount:t.onRemount},null)]})]),l.value&&e.createVNode(oe,{class:`${n.prefix}-catalog-${t.catalogLayout}`,onMouseenter:y,onMouseleave:V},{default:()=>[e.createVNode(X.MdCatalog,{theme:i.value,class:`${n.prefix}-catalog-editor`,editorId:a,mdHeadingId:t.mdHeadingId,key:"internal-catalog",scrollElementOffsetTop:2,syncWith:r.value.preview?"preview":"editor",onClick:(k,w)=>{if(!r.value.preview&&w.line!==void 0){k.preventDefault();const E=m.value?.view;if(E){const L=E.state.doc.line(w.line+1),T=E.lineBlockAt(L.from)?.top,D=E.scrollDOM;No(D,T)}}},catalogMaxDepth:t.catalogMaxDepth,onActive:h},null)]})])}}),$o=e.defineComponent({props:{modelValue:{type:String,default:""}},setup(t){const o=e.inject("usedLanguageText");return()=>e.createVNode("div",{class:`${n.prefix}-footer-item`},[e.createVNode("label",{class:`${n.prefix}-footer-label`},[`${o.value.footer?.markdownTotal}:`]),e.createVNode("span",null,[t.modelValue?.length||0])])}}),Eo={checked:{type:Boolean,default:!1},onChange:{type:Function,default:()=>{}},disabled:{type:Boolean,default:void 0}},Vo=e.defineComponent({name:`${n.prefix}-checkbox`,props:Eo,setup(t){return()=>e.createVNode("div",{class:[`${n.prefix}-checkbox`,t.checked&&`${n.prefix}-checkbox-checked`,t.disabled&&`${n.prefix}-disabled`],onClick:()=>{t.disabled||t.onChange(!t.checked)}},null)}}),So={scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}}},Io=e.defineComponent({props:So,setup(t){const o=e.inject("usedLanguageText"),a=e.inject("disabled");return()=>e.createVNode("div",{class:[`${n.prefix}-footer-item`,a?.value&&`${n.prefix}-disabled`]},[e.createVNode("label",{class:`${n.prefix}-footer-label`,onClick:()=>{a?.value||t.onScrollAutoChange(!t.scrollAuto)}},[o?.value.footer?.scrollAuto]),e.createVNode(Vo,{checked:t.scrollAuto,onChange:t.onScrollAutoChange,disabled:a?.value},null)])}}),Lo={modelValue:{type:String,default:""},footers:{type:Array,default:[]},scrollAuto:{type:Boolean},noScrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}},defFooters:{type:Object}},jo=e.defineComponent({name:"MDEditorFooter",props:Lo,setup(t){const o=e.inject("theme"),a=e.inject("language"),l=e.inject("disabled"),i=e.computed(()=>{const c=t.footers.indexOf("="),d=c===-1?t.footers:t.footers.slice(0,c),u=c===-1?[]:t.footers.slice(c,Number.MAX_SAFE_INTEGER);return[d,u]}),r=c=>{if(n.allFooter.includes(c))switch(c){case"markdownTotal":return e.createVNode($o,{modelValue:t.modelValue},null);case"scrollSwitch":return!t.noScrollAuto&&e.createVNode(Io,{scrollAuto:t.scrollAuto,onScrollAutoChange:t.onScrollAutoChange},null)}else if(t.defFooters instanceof Array){const d=t.defFooters[c];return d?e.cloneVNode(d,{theme:d.props?.theme||o.value,language:d.props?.language||a.value,disabled:d.props?.disabled||l?.value}):""}else if(t.defFooters&&t.defFooters.children instanceof Array){const d=t.defFooters.children[c];return d?e.cloneVNode(d,{theme:d.props?.theme||o.value,language:d.props?.language||a.value,disabled:d.props?.disabled||l?.value}):""}else return""};return()=>{const c=i.value[0].map(u=>r(u)),d=i.value[1].map(u=>r(u));return e.createVNode("div",{class:`${n.prefix}-footer`},[e.createVNode("div",{class:`${n.prefix}-footer-left`},[c]),e.createVNode("div",{class:`${n.prefix}-footer-right`},[d])])}}}),Ao={toolbars:{type:Array,default:()=>[]},toolbarsExclude:{type:Array,default:()=>[]}},Ro=e.defineComponent({name:"MDEditorToolbar",props:Ao,setup(t){const o=e.inject("editorId"),a=e.inject("showToolbarName"),l=`${o}-toolbar-wrapper`,i=e.ref(),r=e.ref(),{barRender:c}=ke(),d=e.computed(()=>{const u=t.toolbars.filter(p=>!t.toolbarsExclude.includes(p)),f=u.indexOf("="),m=f===-1?u:u.slice(0,f+1),g=f===-1?[]:u.slice(f,Number.MAX_SAFE_INTEGER);return[m,g]});return e.watch(()=>t.toolbars,()=>{e.nextTick(()=>{i.value&&W.draggingScroll(i.value)})},{immediate:!0}),()=>{const u=d.value[0].map(m=>c(m)),f=d.value[1].map(m=>c(m));return e.createVNode(e.Fragment,null,[t.toolbars.length>0&&e.createVNode("div",{class:`${n.prefix}-toolbar-wrapper`,ref:i,id:l},[e.createVNode("div",{class:[`${n.prefix}-toolbar`,a.value&&`${n.prefix}-stn`]},[e.createVNode("div",{class:`${n.prefix}-toolbar-left`,ref:r},[u]),e.createVNode("div",{class:`${n.prefix}-toolbar-right`},[f])])])])}}}),Z=e.defineComponent({name:"MdEditorV3",props:S.editorProps,emits:S.editorEmits,setup(t,o){const{noKatex:a,noMermaid:l,noHighlight:i}=t,r=e.reactive({scrollAuto:t.scrollAuto}),c=e.ref(),d=e.ref(),u=e.computed(()=>ce.getSlot({props:t,ctx:o},"defToolbars")),f=e.computed(()=>ce.getSlot({props:t,ctx:o},"defFooters")),m=S.useEditorId(t),[g,p]=S.useConfig(t,o,{editorId:m}),v=S.useCatalog(t,{editorId:m});return S.useOnSave(t,o,{editorId:m}),S.useExpansion(t),S.useErrorCatcher(t,o,{editorId:m}),S.useExpose(t,o,{editorId:m,catalogVisible:v,setting:g,updateSetting:p,codeRef:d}),S.useProvide(t,{rootRef:c,editorId:m,setting:g,updateSetting:p,catalogVisible:v,defToolbars:u}),e.onBeforeUnmount(()=>{s.bus.clear(m)}),()=>e.createVNode("div",{id:m,class:[n.prefix,t.class,t.theme==="dark"&&`${n.prefix}-dark`,g.fullscreen||g.pageFullscreen?`${n.prefix}-fullscreen`:""],style:t.style,ref:c},[t.toolbars.length>0&&e.createVNode(Ro,{toolbars:t.toolbars,toolbarsExclude:t.toolbarsExclude},null),e.createVNode(ko,{ref:d,modelValue:t.modelValue,mdHeadingId:t.mdHeadingId,noMermaid:l,sanitize:t.sanitize,placeholder:t.placeholder,noKatex:a,scrollAuto:r.scrollAuto,formatCopiedText:t.formatCopiedText,autofocus:t.autoFocus,readonly:t.readOnly,maxlength:t.maxLength,autoDetectCode:t.autoDetectCode,noHighlight:i,updateModelValue:h=>{o.emit("update:modelValue",h)},onChange:h=>{t.onChange?.(h),o.emit("onChange",h)},onHtmlChanged:h=>{t.onHtmlChanged?.(h),o.emit("onHtmlChanged",h)},onGetCatalog:h=>{t.onGetCatalog?.(h),o.emit("onGetCatalog",h)},onBlur:h=>{t.onBlur?.(h),o.emit("onBlur",h)},onFocus:h=>{t.onFocus?.(h),o.emit("onFocus",h)},onInput:h=>{t.onInput?.(h),o.emit("onInput",h)},completions:t.completions,noImgZoomIn:t.noImgZoomIn,onDrop:h=>{t.onDrop?.(h),o.emit("onDrop",h)},inputBoxWidth:t.inputBoxWidth,oninputBoxWidthChange:h=>{t.oninputBoxWidthChange?.(h),o.emit("oninputBoxWidthChange",h)},sanitizeMermaid:t.sanitizeMermaid,transformImgUrl:t.transformImgUrl,codeFoldable:t.codeFoldable,autoFoldThreshold:t.autoFoldThreshold,onRemount:()=>{t.onRemount?.(),o.emit("onRemount")},catalogLayout:t.catalogLayout,catalogMaxDepth:t.catalogMaxDepth,noEcharts:t.noEcharts},null),t.footers.length>0&&e.createVNode(jo,{modelValue:t.modelValue,footers:t.footers,defFooters:f.value,noScrollAuto:!g.preview&&!g.htmlPreview||g.previewOnly,scrollAuto:r.scrollAuto,onScrollAutoChange:h=>r.scrollAuto=h},null)])}});Z.install=t=>(t.component(Z.name,Z),t.use(Ae).use(H.DropdownToolbar).use(je).use(X.MdCatalog).use(S.MdPreview),t);module.exports=Z;
