{"version":3,"file":"cfcs.esm.js","sources":["../src/reactive/useReactive.ts"],"sourcesContent":["/**\n * cfcs\n * Copyright (c) 2022-present NAVER Corp.\n * MIT license\n */\nimport {\n  ReactiveAdapterParam,\n  ReactiveSubscribe,\n  camelize,\n  adaptReactive,\n  ReactiveState,\n} from \"@cfcs/core\";\nimport { onMounted, onUnmounted, reactive, Ref, ref } from \"vue\";\nimport { ReactiveLegacyResult, ReactiveResult } from \"./types\";\n\n\n/**\n * @description In Vue 3, you can create reactive components through adapters.\n * @category Reactive\n * @example\n * ```ts\n * import { useReactive } from \"@cfcs/vue3\";\n *\n * export function useReactiveComponent() {\n *   return useReactive(REACTIVE_ADAPTER);\n * }\n * ```\n */\nexport function useReactive<\n  Instance extends ReactiveSubscribe<Record<string, any>>,\n  State extends Record<string, any> = ReactiveState<Instance>,\n  Methods extends keyof Partial<Instance> = any,\n  Props = any,\n  Events extends Record<string, any> = {},\n>(\n  reactiveAdapter: ReactiveAdapterParam<Instance, State, Methods, Props, Events>,\n  props?: () => Props,\n): ReactiveResult<Instance, State, Methods, Events> {\n  const adaptResult = adaptReactive(reactiveAdapter, props);\n  const reactiveState = adaptResult.state();\n  const names = Object.keys(reactiveState);\n  const refs: Record<string, Ref<any>> = {};\n  for (const name in reactiveState) {\n    refs[name] = ref(reactiveState[name]);\n  }\n  const methods = adaptResult.methods();\n\n  onMounted(() => {\n    adaptResult.mounted();\n\n    const inst = adaptResult.instance();\n\n    names.forEach(name => {\n      inst.subscribe(name as any, (value: any) => {\n        refs[name].value = value;\n      });\n    });\n\n    adaptResult.init();\n  });\n\n  onUnmounted(() => {\n    adaptResult.destroy();\n  });\n\n  const reactiveEvents = adaptResult.events();\n  const events = reactiveEvents.reduce((eventResult, name) => {\n    eventResult[camelize(`on ${name as any}`)] = (callback: (...args: any[]) => void) => {\n      adaptResult.on(name as any, callback as any);\n\n      onUnmounted(() => {\n        adaptResult.off(name as any, callback as any);\n      });\n    };\n\n    return eventResult;\n  }, {} as Record<string, any>);\n\n  return {\n    ...refs,\n    ...methods,\n    ...events,\n  } as any;\n}\n\n\n/**\n * @category Reactive\n * @hidden\n */\nexport function useLegacyReactive<\n  Instance extends ReactiveSubscribe<Record<string, any>>,\n  State extends Record<string, any> = ReactiveState<Instance>,\n  Methods extends keyof Partial<Instance> = any,\n  Props = any,\n  Events extends Record<string, any> = {},\n>(\n  reactiveAdapter: ReactiveAdapterParam<Instance, State, Methods, Props, Events>,\n  props?: () => Props,\n): ReactiveLegacyResult<Instance, State, Methods, Events> {\n  const adaptResult = adaptReactive(reactiveAdapter, props);\n  const reactiveState = adaptResult.state();\n  const names = Object.keys(reactiveState);\n  let result!: Record<string, any>;\n\n  const methods = adaptResult.methods();\n\n  onMounted(() => {\n    adaptResult.mounted();\n\n    const inst = adaptResult.instance();\n\n    names.forEach(name => {\n      inst.subscribe(name as any, (value: any) => {\n        result[name] = value;\n      });\n    });\n\n    adaptResult.init();\n  });\n\n  onUnmounted(() => {\n    adaptResult.destroy();\n  });\n\n  const reactiveEvents = adaptResult.events();\n  const events = reactiveEvents.reduce((eventResult, name) => {\n    eventResult[camelize(`on ${name as any}`)] = (callback: (...args: any[]) => void) => {\n      adaptResult.on(name as any, callback as any);\n\n      onUnmounted(() => {\n        adaptResult.off(name as any, callback as any);\n      });\n    };\n\n    return eventResult;\n  }, {} as Record<string, any>);\n\n  result = reactive({\n    ...reactiveState,\n    ...methods,\n    ...events,\n  });\n\n\n  return result as any;\n}\n"],"names":["useReactive","reactiveAdapter","props","adaptResult","adaptReactive","reactiveState","state","names","Object","keys","refs","name","ref","methods","onMounted","mounted","inst","instance","forEach","subscribe","value","init","onUnmounted","destroy","reactiveEvents","events","reduce","eventResult","camelize","concat","callback","on","off","__assign","useLegacyReactive","result","reactive"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA;;;;;;;;;;;AAWG;;AACa,SAAAA,WAAA,CAOdC,eAPc,EAQdC,KARc,EAQK;AAEnB,EAAA,IAAMC,WAAW,GAAGC,aAAa,CAACH,eAAD,EAAkBC,KAAlB,CAAjC,CAAA;AACA,EAAA,IAAMG,aAAa,GAAGF,WAAW,CAACG,KAAZ,EAAtB,CAAA;AACA,EAAA,IAAMC,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYJ,aAAZ,CAAd,CAAA;EACA,IAAMK,IAAI,GAA6B,EAAvC,CAAA;;AACA,EAAA,KAAK,IAAMC,IAAX,IAAmBN,aAAnB,EAAkC;IAChCK,IAAI,CAACC,IAAD,CAAJ,GAAaC,GAAG,CAACP,aAAa,CAACM,IAAD,CAAd,CAAhB,CAAA;AACD,GAAA;;AACD,EAAA,IAAME,OAAO,GAAGV,WAAW,CAACU,OAAZ,EAAhB,CAAA;AAEAC,EAAAA,SAAS,CAAC,YAAA;AACRX,IAAAA,WAAW,CAACY,OAAZ,EAAA,CAAA;AAEA,IAAA,IAAMC,IAAI,GAAGb,WAAW,CAACc,QAAZ,EAAb,CAAA;AAEAV,IAAAA,KAAK,CAACW,OAAN,CAAc,UAAAP,IAAA,EAAI;AAChBK,MAAAA,IAAI,CAACG,SAAL,CAAeR,IAAf,EAA4B,UAACS,KAAD,EAAW;AACrCV,QAAAA,IAAI,CAACC,IAAD,CAAJ,CAAWS,KAAX,GAAmBA,KAAnB,CAAA;OADF,CAAA,CAAA;KADF,CAAA,CAAA;AAMAjB,IAAAA,WAAW,CAACkB,IAAZ,EAAA,CAAA;AACD,GAZQ,CAAT,CAAA;AAcAC,EAAAA,WAAW,CAAC,YAAA;AACVnB,IAAAA,WAAW,CAACoB,OAAZ,EAAA,CAAA;AACD,GAFU,CAAX,CAAA;AAIA,EAAA,IAAMC,cAAc,GAAGrB,WAAW,CAACsB,MAAZ,EAAvB,CAAA;EACA,IAAMA,MAAM,GAAGD,cAAc,CAACE,MAAf,CAAsB,UAACC,WAAD,EAAchB,IAAd,EAAkB;AACrDgB,IAAAA,WAAW,CAACC,QAAQ,CAAC,KAAA,CAAMC,MAAN,CAAMlB,IAAN,CAAD,CAAT,CAAX,GAA6C,UAACmB,QAAD,EAAmC;AAC9E3B,MAAAA,WAAW,CAAC4B,EAAZ,CAAepB,IAAf,EAA4BmB,QAA5B,CAAA,CAAA;AAEAR,MAAAA,WAAW,CAAC,YAAA;AACVnB,QAAAA,WAAW,CAAC6B,GAAZ,CAAgBrB,IAAhB,EAA6BmB,QAA7B,CAAA,CAAA;AACD,OAFU,CAAX,CAAA;KAHF,CAAA;;AAQA,IAAA,OAAOH,WAAP,CAAA;GATa,EAUZ,EAVY,CAAf,CAAA;AAYA,EAAA,OAAOM,+BACFvB,OACAG,UACAY,OAHL,CAAA;AAKD,CAAA;AAGD;;;AAGG;;AACa,SAAAS,iBAAA,CAOdjC,eAPc,EAQdC,KARc,EAQK;AAEnB,EAAA,IAAMC,WAAW,GAAGC,aAAa,CAACH,eAAD,EAAkBC,KAAlB,CAAjC,CAAA;AACA,EAAA,IAAMG,aAAa,GAAGF,WAAW,CAACG,KAAZ,EAAtB,CAAA;AACA,EAAA,IAAMC,KAAK,GAAGC,MAAM,CAACC,IAAP,CAAYJ,aAAZ,CAAd,CAAA;AACA,EAAA,IAAI8B,MAAJ,CAAA;AAEA,EAAA,IAAMtB,OAAO,GAAGV,WAAW,CAACU,OAAZ,EAAhB,CAAA;AAEAC,EAAAA,SAAS,CAAC,YAAA;AACRX,IAAAA,WAAW,CAACY,OAAZ,EAAA,CAAA;AAEA,IAAA,IAAMC,IAAI,GAAGb,WAAW,CAACc,QAAZ,EAAb,CAAA;AAEAV,IAAAA,KAAK,CAACW,OAAN,CAAc,UAAAP,IAAA,EAAI;AAChBK,MAAAA,IAAI,CAACG,SAAL,CAAeR,IAAf,EAA4B,UAACS,KAAD,EAAW;AACrCe,QAAAA,MAAM,CAACxB,IAAD,CAAN,GAAeS,KAAf,CAAA;OADF,CAAA,CAAA;KADF,CAAA,CAAA;AAMAjB,IAAAA,WAAW,CAACkB,IAAZ,EAAA,CAAA;AACD,GAZQ,CAAT,CAAA;AAcAC,EAAAA,WAAW,CAAC,YAAA;AACVnB,IAAAA,WAAW,CAACoB,OAAZ,EAAA,CAAA;AACD,GAFU,CAAX,CAAA;AAIA,EAAA,IAAMC,cAAc,GAAGrB,WAAW,CAACsB,MAAZ,EAAvB,CAAA;EACA,IAAMA,MAAM,GAAGD,cAAc,CAACE,MAAf,CAAsB,UAACC,WAAD,EAAchB,IAAd,EAAkB;AACrDgB,IAAAA,WAAW,CAACC,QAAQ,CAAC,KAAA,CAAMC,MAAN,CAAMlB,IAAN,CAAD,CAAT,CAAX,GAA6C,UAACmB,QAAD,EAAmC;AAC9E3B,MAAAA,WAAW,CAAC4B,EAAZ,CAAepB,IAAf,EAA4BmB,QAA5B,CAAA,CAAA;AAEAR,MAAAA,WAAW,CAAC,YAAA;AACVnB,QAAAA,WAAW,CAAC6B,GAAZ,CAAgBrB,IAAhB,EAA6BmB,QAA7B,CAAA,CAAA;AACD,OAFU,CAAX,CAAA;KAHF,CAAA;;AAQA,IAAA,OAAOH,WAAP,CAAA;GATa,EAUZ,EAVY,CAAf,CAAA;AAYAQ,EAAAA,MAAM,GAAGC,QAAQ,CACZH,QAAA,CAAAA,QAAA,CAAAA,QAAA,CAAA,EAAA,EAAA5B,aAAA,CAAA,EACAQ,OADA,CAAA,EAEAY,MAFA,CADY,CAAjB,CAAA;AAOA,EAAA,OAAOU,MAAP,CAAA;AACD;;;;"}